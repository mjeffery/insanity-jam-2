!function(a){a.Util={override:function(a,b,c){var d=a[b];a[b]=function(){var a=this.__super;this.__super=d;var b=c.apply(this,arguments);return this.__super=a,b}}}}(this),function(a){function b(a){return function(b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b[c]&&"function"==typeof d?Util.override(b,c,d):b[c]=d}}}a.Mixin={create:b}}(this),function(a){function b(a){_.extend(this,{game:a,keyboard:a.input.keyboard,keys:{},events:{onCommand:new Phaser.Signal,onStringStart:new Phaser.Signal,onTimerChanged:new Phaser.Signal,onStringEnd:new Phaser.Signal},_stringTimer:0,_stringTimerMax:1,keyTimer:0,keyTimerMax:.333,state:"waiting",enabled:!0,buffer:[]}),this.mapKey(Phaser.Keyboard.A,"left arm extend"),this.mapKey(Phaser.Keyboard.S,"left arm retract"),this.mapKey(Phaser.Keyboard.D,"left leg extend"),this.mapKey(Phaser.Keyboard.F,"left leg retract"),this.mapKey(Phaser.Keyboard.COLON,"right arm extend"),this.mapKey(Phaser.Keyboard.L,"right arm retract"),this.mapKey(Phaser.Keyboard.K,"right leg extend"),this.mapKey(Phaser.Keyboard.J,"right leg retract")}_.extend(b.prototype,{update:function(){if("in string"===this.state){var a=this.game.time.physicsElapsed;this.keyTimer+=a,this.stringTimer+=a,(this.keyTimer>=this.keyTimerMax||this.stringTimer>=this.stringTimerMax)&&this.endString()}},startString:function(){this.events.onStringStart.dispatch(this),this.stringTimer=0,this.state="in string"},endString:function(){var a=this.buffer;this.buffer=[],this.events.onStringEnd.dispatch(a,this),this.state="waiting"},pushCommand:function(a){"waiting"===this.state&&this.startString(),this.buffer.push(a),this.keyTimer=0,this.events.onCommand.dispatch(a,this)},timerChanged:function(){var a=this.stringTimer,b=this.stringTimerMax,c=0===b?0:a/b;this.events.onTimerChanged.dispatch(a,b,c,this)},mapKey:function(a,b){var c=this.keyboard.addKey(a);this.keys[a]={key:c,command:b},c.onDown.add(this.onKeyDown,this)},onKeyDown:function(a){var b=this.keys[a.keyCode];b&&this.pushCommand(b.command)}}),Object.defineProperties(b.prototype,{stringTimer:{get:function(){return this._stringTimer},set:function(a){a=Math.max(a,0),a=Math.min(a,this.stringTimerMax),this._stringTimer!==a&&(this._stringTimer=a,this.timerChanged())}},stringTimerMax:{get:function(){return this._stringTimerMax},set:function(){newMax=Math.max(0,newMax),newMax!==this._stringTimerMax&&(this._stringTimerMax=newMax,this._stringTimer>newMax&&(this._stringTimer=newMax),this.timerChanged())}},commandsToKeyCodes:{get:function(){return _.chain(this.keys).mapValues("command").invert().value()}}}),a.CommandBuffer=b}(this),function(a){function b(a,b){Phaser.Group.call(this,a),void 0===b&&(b=50),this.createMultiple(b,"command-keys");var c=[Phaser.Keyboard.A,Phaser.Keyboard.S,Phaser.Keyboard.D,Phaser.Keyboard.F,Phaser.Keyboard.J,Phaser.Keyboard.K,Phaser.Keyboard.L,Phaser.Keyboard.COLON];this.codesToFrames=_.reduce(c,function(a,b,c){return a[b]=c,a},{})}_.extend(b,{preload:function(a){a.spritesheet("command-keys","assets/command keys.956c5489.png",32,32,8)}}),b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,_.extend(b.prototype,{obtain:function(a){var b=this.getFirstDead(),c=this.codesToFrames[a];return this.remove(b,!1,!0),b.reset(0,-16),b.alpha=1,b.frame=c,b},release:function(a){a.kill(),this.add(a)}}),a.CommandKeyPool=b}(this),function(a){function b(a,b,c,d){Phaser.Group.call(this,a),_.extend(this,{commandKeyPool:b,x:c||0,y:d||0})}_.extend(b,{Spacing:{Width:32,Gap:2},Fade:{Duration:1500}}),b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,_.extend(b.prototype,{addKey:function(a){var b=this.commandKeyPool.obtain(a);this.add(b),this.recenter()},recenter:function(){var a=this.countLiving();if(0!==a){var c=a*b.Spacing.Width+(a-1)*b.Spacing.Gap,d=-c/2,e=b.Spacing.Width+b.Spacing.Gap;this.forEachAlive(function(a){a.position.x=d,d+=e})}},fadeOut:function(a){this.forEach(function(c){this.game.add.tween(c).to({alpha:0},b.Fade.Duration,void 0,!0,a).onComplete.addOnce(this._onComplete,this)},this)},_onComplete:function(a){this.remove(a),this.commandKeyPool.release(a)}}),a.CommandString=b}(this),function(a){function b(a,b,c,d){_.extend(this,{state:"relaxed",torso:{joint:a,options:_.defaults(b||{},{extended:{limit:-Math.PI/8,motorDir:1},retracted:{limit:3*Math.PI/4,motorDir:-1}})},limb:{joint:c,options:_.defaults(d||{},{extended:{limit:-Math.PI/8,motorDir:1},retracted:{limit:3*Math.PI/4,motorDir:-1}})}})}b.prototype={extend:function(a){var b=this.limb,c=this.torso;this.driveJoint(c.joint,a,c.options.extended),this.driveJoint(b.joint,a,b.options.extended),this.state="extending"},retract:function(a){var b=this.limb,c=this.torso;this.driveJoint(c.joint,a,c.options.retracted),this.driveJoint(b.joint,a,b.options.retracted),this.state="retracting"},update:function(){},driveJoint:function(a,b,c){c.motorDir>0?a.lowerLimit=c.limit:a.upperLimit=c.limit,a.motorIsEnabled()||a.enableMotor(),a.setMotorSpeed(b*c.motorDir)},mirror:function(a,c){function d(a){return{limit:-a.limit,motorDir:-a.motorDir}}function e(a){return{retracted:d(a.retracted),extended:d(a.extended)}}return new b(a,e(this.torso.options),c,e(this.limb.options))}},a.LimbController=b}(this),function(a){function b(a,b,c){var d=a.physics;this.game=a,this.debug=!!c,this.collisionGroups={bodyParts:d.p2.createCollisionGroup(),world:b};var e=this.left={},f=this.right={};e.thigh=this.addPart(335,335.6,"robot thigh left"),f.thigh=this.addPart(407.6,339.1,"robot thigh right"),e.arm=this.addPart(100,100,"robot arm left"),f.arm=this.addPart(300,100,"robot arm right");var g=this.torso=this.addPart(375,228.6,"robot torso"),h=this.head=this.addPart(370,180,"robot head");h.mass=1,e.foot=this.addPart(298.5,436.5,"robot foot left"),e.foot.body.mass=1,f.foot=this.addPart(460.6,458.3,"robot foot right"),f.foot.body.mass=1,e.hand=this.addPart(200,300,"robot hand left"),f.hand=this.addPart(400,300,"robot hand right"),e.knee=this.addJoint(e.foot,[22,-69],e.thigh,[-4,61]),f.knee=this.addJoint(f.foot,[-33,-71],f.thigh,[2,62]),e.hip=this.addJoint(e.thigh,[12,-58],g,[-18,53]),f.hip=this.addJoint(f.thigh,[-14,-57],g,[15,55]),e.shoulder=this.addJoint(e.arm,[20,-44],g,[-37,-42]),f.shoulder=this.addJoint(f.arm,[-21,-45],g,[39,-36]),e.elbow=this.addJoint(e.hand,[-7,63],e.arm,[-31,51]),f.elbow=this.addJoint(f.hand,[6,60],f.arm,[30,52]),this.neck=this.addJoint(g,[0,-49],h,[0,0]),e.legController=new LimbController(e.hip,{retracted:{limit:-3*Math.PI/4,motorDir:1},extended:{limit:0,motorDir:-1}},e.knee,{retracted:{limit:3*Math.PI/4,motorDir:-1},extended:{limit:0,motorDir:1}}),e.armController=new LimbController(e.shoulder,{retracted:{limit:Math.PI/8,motorDir:-1},extended:{limit:-3*Math.PI/8,motorDir:1}},e.elbow,{retracted:{limit:-Math.PI/8,motorDir:2},extended:{limit:Math.PI,motorDir:-1.75}}),f.legController=e.legController.mirror(f.hip,f.knee),f.armController=e.armController.mirror(f.shoulder,f.elbow),e.legController.extend(1),f.legController.extend(1),e.armController.retract(1),f.armController.retract(1)}_.extend(b,{preload:function(a){a.image("robot head","assets/robot head.2405000f.png"),a.image("robot torso","assets/robot torso.c970430b.png"),a.image("robot thigh left","assets/robot thigh left.e37012d3.png"),a.image("robot thigh right","assets/robot thigh right.90cc9458.png"),a.image("robot foot left","assets/robot foot left.7a35da61.png"),a.image("robot foot right","assets/robot foot right.f0693a46.png"),a.image("robot arm left","assets/robot arm left.976d7564.png"),a.image("robot arm right","assets/robot arm right.bd9ece10.png"),a.image("robot hand left","assets/robot hand left.519a8619.png"),a.image("robot hand right","assets/robot hand right.6355453c.png"),a.physics("robot physics","assets/robot.e96213a0.json")}}),b.prototype={addPart:function(a,b,c){var d=this.game.add.sprite(a,b,c);return this.game.physics.p2.enable(d,this.debug),d.body.clearShapes(),d.body.loadPolygon("robot physics",c),d.body.setCollisionGroup(this.collisionGroups.bodyParts),d.body.collides(this.collisionGroups.world),d},addJoint:function(a,b,c,d){var e=this.game.physics.p2.createRevoluteConstraint(a,b,c,d);return e.upperLimitEnabled=!0,e.upperLimit=Math.PI/8,e.lowerLimitEnabled=!0,e.lowerLimit=-Math.PI/8,e},squat:function(){this.left.legController.retract(1),this.right.legController.retract(1)},jump:function(){this.left.legController.extend(10),this.right.legController.extend(10)},punch:function(){this.left.armController.extend(5),this.right.armController.extend(5)},defend:function(){this.left.armController.retract(3),this.right.armController.retract(3)},processCommandString:function(a){var b,c,d,e=this;_.chain(a).groupBy().reduce(function(a,b,c){return a[c]=b.length||0,a},{}).forEach(function(a,f){b=_.contains(f,"left")?e.left:e.right,c=_.contains(f,"arm")?b.armController:b.legController,d=_.contains(f,"extend")?"extend":"retract",c[d](a)})},destroy:function(){}},a.Robot=b}(this),function(a){function b(a,b,c){Phaser.Sprite.call(this,a,b,c,"timer-bar-bg");var d=this._bar=a.make.sprite(0,0,"timer-bar"),e=this._rect=new Phaser.Rectangle(0,0,1,this.height);this.addChild(d),d.crop(e)}_.extend(b,{preload:function(a){a.image("timer-bar-bg","assets/timer bar bg.7000549c.png"),a.image("timer-bar","assets/timer bar.35ceeabe.png")}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,Object.defineProperties(b.prototype,{value:{set:function(a){a=Math.max(0,a),a=Math.min(1,a),this._rect.width=Math.floor(this.width*a),this._bar.crop(this._rect)}}}),a.TimerBar=b}(this),function(a){function b(a,b,c){Phaser.Group.call(this,a,void 0,!0),_.extend(this,{commandKeyPool:b,commandsToKeyCodes:c});var d=this.timerBar=this.add(new TimerBar(a,-50,18));d.visible=!1,d.value=0}_.extend(b,{Spacing:{Height:32,Gap:4},Tween:{Duration:500},CommandLifetime:3e3,preload:function(){}}),b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,_.extend(b.prototype,{moveAllUp:function(){var a,c=b.Spacing.Height+b.Spacing.Gap;this.forEach(function(d){d instanceof CommandString&&(a=d.y-c,this.game.add.tween(d).to({y:a},b.Tween.Duration).start())},this)},onStringStart:function(){var a=new CommandString(this.game,this.commandKeyPool,this.x,this.y);this.add(a),this.workingString=a,this.timerBar.visible=!0},onStringEnd:function(){this.workingString.fadeOut(b.CommandLifetime),this.workingString=void 0,this.moveAllUp(),this.timerBar.visible=!1},onCommand:function(a){if(this.workingString){var b=this.commandsToKeyCodes[a];b?this.workingString.addKey(b):console.error('cannot find keycode for command "'+a+'"')}},onTimerChanged:function(a,b,c){this.timerBar.value=c}}),a.CommandDisplay=b}(this),function a(b){function a(a){Phaser.Group.call(this,a);var b=this.pages=[a.make.sprite(0,0,"instructions-page-1"),a.make.sprite(0,0,"instructions-page-2")];_.forEach(b,function(b){this.add(b),b.anchor.setTo(.5,.5),b.position.setTo(a.width/2,a.height/2),b.visible=!1},this),this.currentPage=0,b[0].visible=!0;var c=this.advanceKey=a.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);c.onDown.add(this.advance,this)}_.extend(a,{preload:function(a){a.image("instructions-page-1","assets/instructions for keys.6983c503.png"),a.image("instructions-page-2","assets/instructions for strings.a22ef008.png")}}),a.prototype=Object.create(Phaser.Group.prototype),a.prototype.constructor=a,Mixin.create({destroy:function(){this.advanceKey.onDown.remove(this.advance,this),this.__super.apply(this,arguments)},advance:function(){var a=this.pages,b=this.currentPage;newPage=this.currentPage+1,a[b].visible=!1,newPage>=a.length?this.destroy():(a[newPage].visible=!0,this.currentPage=newPage)}})(a.prototype),b.Instructions=a}(this),function(a){function b(){}b.prototype={preload:function(){this.load.image("loading-bar","assets/loading bar.f44b1a70.png"),this.load.image("loading-bar-bg","assets/loading bar bg.1fe86dc8.png")},create:function(){this.state.start("preload")}},a.Boot=b}(this),function(a){function b(){}b.prototype={preload:function(){var a=250,b=296,c=this.add,d=this.load;c.sprite(a,b,"loading-bar-bg");var e=c.sprite(a,b,"loading-bar");d.setPreloadSprite(e),d.bitmapFont("minecraftia","assets/minecraftia.d0c5b06a.png","assets/minecraftia.22ff6d4c.xml"),Robot.preload(d),Game.preload(d),CommandKeyPool.preload(d),TimerBar.preload(d),CommandDisplay.preload(d),Instructions.preload(d),d.onLoadComplete.addOnce(this.onLoadComplete,this)},create:function(){this.stage.backgroundColor="#000000"},onLoadComplete:function(){this.state.start("game")}},a.Preload=b}(this),function(a){function b(){}b.preload=function(a){a.image("dirt","assets/dirt.f386c547.png")},b.prototype={create:function(){var a=this.game.physics,b=this.add,c=!1;this.game.stage.setBackgroundColor("#6495ED"),a.startSystem(Phaser.Physics.P2JS),a.p2.gravity.y=300;var d=a.p2.createCollisionGroup(),e=this.robot=new Robot(this.game,d,c),f=b.tileSprite(400,568,800,64,"dirt",0);a.p2.enable(f,c),f.body.setRectangleFromSprite(f),f.body.static=!0,f.body.setCollisionGroup(d),f.body.collides(e.collisionGroups.bodyParts),new Instructions(this.game);var g=this.commandBuffer=new CommandBuffer(this.game),h=this.commandKeyPool=new CommandKeyPool(this.game),i=this.commandDisplay=new CommandDisplay(this.game,h,g.commandsToKeyCodes);i.x=200,i.y=275,i.timerBar.x=135,i.timerBar.y=292,g.events.onStringEnd.add(e.processCommandString,e),g.events.onStringStart.add(i.onStringStart,i),g.events.onCommand.add(i.onCommand,i),g.events.onStringEnd.add(i.onStringEnd,i),g.events.onTimerChanged.add(i.onTimerChanged,i)},update:function(){this.commandBuffer.update()}},a.Game=b}(this);var game=new Phaser.Game(800,600,Phaser.AUTO,"game-container");game.state.add("boot",Boot),game.state.add("preload",Preload),game.state.add("game",Game),game.state.start("boot");