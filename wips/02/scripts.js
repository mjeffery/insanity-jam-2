!function(a){a.Util={override:function(a,b,c){var d=a[b];a[b]=function(){var a=this.__super;this.__super=d;var b=c.apply(this,arguments);return this.__super=a,b}}}}(this),function(a){function b(a){return function(b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b[c]&&"function"==typeof d?Util.override(b,c,d):b[c]=d}}}a.Mixin={create:b}}(this),function(a){function b(a){this._callbacks=[],a.physics.p2.setPostBroadphaseCallback(this.callback,this)}b.prototype={callback:function(a,b){for(var c,d,e,f=!1,g=this._callbacks||[],h=0;h<g.length;h++)d=g[h].fn,c=g[h].ctx||{},(!f||g[h].always)&&(e=d.call(c,a,b),f||(f=!e));return!f},addCallback:function(a,b,c){this._callbacks.push({fn:a,ctx:b,always:c})}},a.PostBroadphaseProcessor=b}(this),function(a){new Phaser.Point;a.SAT={circleVsRect:function(a,b){return a.x-a.radius>b.right?!1:a.x+a.radius<b.left?!1:a.y-a.radius>b.bottom?!1:a.y+a.radius<b.top?!1:!0}}}(this),function(a){function b(a){_.extend(this,{game:a,keyboard:a.input.keyboard,keys:{},events:{onCommand:new Phaser.Signal,onStringStart:new Phaser.Signal,onTimerChanged:new Phaser.Signal,onStringEnd:new Phaser.Signal},_stringTimer:0,_stringTimerMax:1,keyTimer:0,keyTimerMax:.333,state:"waiting",enabled:!0,buffer:[]}),this.mapKey(Phaser.Keyboard.A,"left arm extend"),this.mapKey(Phaser.Keyboard.S,"left arm retract"),this.mapKey(Phaser.Keyboard.D,"left leg extend"),this.mapKey(Phaser.Keyboard.F,"left leg retract"),this.mapKey(Phaser.Keyboard.COLON,"right arm extend"),this.mapKey(Phaser.Keyboard.L,"right arm retract"),this.mapKey(Phaser.Keyboard.K,"right leg extend"),this.mapKey(Phaser.Keyboard.J,"right leg retract")}_.extend(b.prototype,{update:function(){if("in string"===this.state){var a=this.game.time.physicsElapsed;this.keyTimer+=a,this.stringTimer+=a,(this.keyTimer>=this.keyTimerMax||this.stringTimer>=this.stringTimerMax)&&this.endString()}},startString:function(){this.events.onStringStart.dispatch(this),this.stringTimer=0,this.state="in string"},endString:function(){var a=this.buffer;this.buffer=[],this.events.onStringEnd.dispatch(a,this),this.state="waiting"},pushCommand:function(a){"waiting"===this.state&&this.startString(),this.buffer.push(a),this.keyTimer=0,this.events.onCommand.dispatch(a,this)},timerChanged:function(){var a=this.stringTimer,b=this.stringTimerMax,c=0===b?0:a/b;this.events.onTimerChanged.dispatch(a,b,c,this)},mapKey:function(a,b){var c=this.keyboard.addKey(a);this.keys[a]={key:c,command:b},c.onDown.add(this.onKeyDown,this)},onKeyDown:function(a){var b=this.keys[a.keyCode];b&&this.pushCommand(b.command)}}),Object.defineProperties(b.prototype,{stringTimer:{get:function(){return this._stringTimer},set:function(a){a=Math.max(a,0),a=Math.min(a,this.stringTimerMax),this._stringTimer!==a&&(this._stringTimer=a,this.timerChanged())}},stringTimerMax:{get:function(){return this._stringTimerMax},set:function(){newMax=Math.max(0,newMax),newMax!==this._stringTimerMax&&(this._stringTimerMax=newMax,this._stringTimer>newMax&&(this._stringTimer=newMax),this.timerChanged())}},commandsToKeyCodes:{get:function(){return _.chain(this.keys).mapValues("command").invert().value()}}}),a.CommandBuffer=b}(this),function(a){function b(a,b){Phaser.Group.call(this,a),void 0===b&&(b=50),this.createMultiple(b,"command-keys");var c=[Phaser.Keyboard.A,Phaser.Keyboard.S,Phaser.Keyboard.D,Phaser.Keyboard.F,Phaser.Keyboard.J,Phaser.Keyboard.K,Phaser.Keyboard.L,Phaser.Keyboard.COLON];this.codesToFrames=_.reduce(c,function(a,b,c){return a[b]=c,a},{})}_.extend(b,{preload:function(a){a.spritesheet("command-keys","assets/command keys.956c5489.png",32,32,8)}}),b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,_.extend(b.prototype,{obtain:function(a){var b=this.getFirstDead(),c=this.codesToFrames[a];return this.remove(b,!1,!0),b.reset(0,-16),b.alpha=1,b.frame=c,b},release:function(a){a.kill(),this.add(a)}}),a.CommandKeyPool=b}(this),function(a){function b(a,b,c,d){Phaser.Group.call(this,a),_.extend(this,{commandKeyPool:b,x:c||0,y:d||0})}_.extend(b,{Spacing:{Width:32,Gap:2},Fade:{Duration:1500}}),b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,_.extend(b.prototype,{addKey:function(a){var b=this.commandKeyPool.obtain(a);this.add(b),this.recenter()},recenter:function(){var a=this.countLiving();if(0!==a){var c=a*b.Spacing.Width+(a-1)*b.Spacing.Gap,d=-c/2,e=b.Spacing.Width+b.Spacing.Gap;this.forEachAlive(function(a){a.position.x=d,d+=e})}},fadeOut:function(a){this.forEach(function(c){this.game.add.tween(c).to({alpha:0},b.Fade.Duration,void 0,!0,a).onComplete.addOnce(this._onComplete,this)},this)},_onComplete:function(a){this.remove(a),this.commandKeyPool.release(a)}}),a.CommandString=b}(this),function(a){function b(a,b,c,d){_.extend(this,{state:"relaxed",torso:{joint:a,options:_.defaults(b||{},{extended:{limit:-Math.PI/8,motorDir:1,scale:1},retracted:{limit:3*Math.PI/4,motorDir:-1,scale:1}})},limb:{joint:c,options:_.defaults(d||{},{extended:{limit:-Math.PI/8,motorDir:1,scale:1},retracted:{limit:3*Math.PI/4,motorDir:-1,scale:1}})}})}b.prototype={extend:function(a){var b=this.limb,c=this.torso;this.driveJoint(c.joint,a,c.options.extended),this.driveJoint(b.joint,a,b.options.extended),this.state="extending"},retract:function(a){var b=this.limb,c=this.torso;this.driveJoint(c.joint,a,c.options.retracted),this.driveJoint(b.joint,a,b.options.retracted),this.state="retracting"},update:function(){},driveJoint:function(a,b,c){c.motorDir>0?a.lowerLimit=c.limit:a.upperLimit=c.limit,a.motorIsEnabled()||a.enableMotor(),a.setMotorSpeed(b*c.motorDir)},mirror:function(a,c){function d(a){return{limit:-a.limit,motorDir:-a.motorDir}}function e(a){return{retracted:d(a.retracted),extended:d(a.extended)}}return new b(a,e(this.torso.options),c,e(this.limb.options))}},a.LimbController=b}(this),function(a){function b(a,b,c,d){Phaser.TileSprite.call(this,a,a.world.bounds.centerX,c,a.world.bounds.width,64,"dirt",0),a.physics.p2.enable(this,d),this.body.setRectangleFromSprite(this),this.body.static=!0,this.body.setCollisionGroup(b.world),this.body.collides(b.player.body);var e=this.arcade=a.make.sprite(a.world.bounds.left,c-32);a.physics.arcade.enable(e),e.body.setSize(a.world.bounds.width,64),e.body.immovable=!0}_.extend(b,{preload:function(a){a.image("dirt","assets/dirt.f386c547.png")}}),b.prototype=Object.create(Phaser.TileSprite.prototype),b.prototype.constructor=b,a.Ground=b}(this),function(a){function b(a,b,c,d,e){a.physics;this.game=a,this.debug=!!e,this.collisionGroups=b,this._parts=[];var f=this.left={},g=this.right={};this.startx=(c||0)-324,this.starty=(d||0)-234,this._temp={circle:{x:0,y:0,radius:0},rect:new Phaser.Rectangle,accumulator:{min:{x:0,y:0},max:{x:0,y:0}}},f.thigh=this.addPart(305,331,"robot left thigh"),g.thigh=this.addPart(348,332,"robot right thigh"),f.arm=this.addPart(275,218,"robot left arm"),g.arm=this.addPart(372,218,"robot right arm");var h=this.torso=this.addPart(324,234,"robot chest"),i=this.head=this.addPart(325,171,"robot head");f.foot=this.addPart(290,420,"robot left boot"),g.foot=this.addPart(361,420,"robot right boot"),f.hand=this.addPart(266,214,"robot left fist"),g.hand=this.addPart(382,214,"robot right fist"),f.knee=this.addJoint(f.foot,[14.5,-37.5],f.thigh,[1,51.5]),g.knee=this.addJoint(g.foot,[-14.5,-37.5],g.thigh,[-1,51.5]),f.hip=this.addJoint(f.thigh,[-1,-50.5],h,[-19,46.5]),g.hip=this.addJoint(g.thigh,[1,-50.5],h,[27,46.5]),f.shoulder=this.addJoint(f.arm,[28.5,-13],h,[-28,-38.5]),g.shoulder=this.addJoint(g.arm,[-28.5,-13],h,[27,-38.5]),f.elbow=this.addJoint(f.hand,[-18.5,36.5],f.arm,[-37.5,19]),g.elbow=this.addJoint(g.hand,[18.5,36.5],g.arm,[37.5,19]),this.neck=this.addJoint(h,[0,-63.5],i,[0,0]),this.damageSources=[],this.addDamage(f.hand,[-2,21],20),this.addDamage(g.hand,[3,20],20),this.addDamage(f.foot,[0,-15],30),this.addDamage(g.foot,[0,-15],30),f.legController=new LimbController(f.hip,{retracted:{limit:-3*Math.PI/4,motorDir:1},extended:{limit:0,motorDir:-1}},f.knee,{retracted:{limit:3*Math.PI/4,motorDir:-1},extended:{limit:0,motorDir:1}}),f.armController=new LimbController(f.shoulder,{retracted:{limit:5*Math.PI/16,motorDir:-1},extended:{limit:-3*Math.PI/16,motorDir:1}},f.elbow,{retracted:{limit:-2*Math.PI/8,motorDir:2},extended:{limit:3*Math.PI/4,motorDir:-2}}),g.legController=f.legController.mirror(g.hip,g.knee),g.armController=f.armController.mirror(g.shoulder,g.elbow),f.legController.extend(1),g.legController.extend(1),f.armController.retract(1),g.armController.retract(1)}function c(a,b,c,d){Phaser.Sprite.call(this,a,b,c),this.prev={x:b,y:c},this.visible=!1,this._circle={x:b,y:c,radius:d}}_.extend(b,{preload:function(a){a.atlasJSONArray("player atlas","assets/player.4378e24f.png","assets/player.29031512.json"),a.physics("player physics","assets/new robot.d74bf7a5.json")}}),b.prototype={addPart:function(a,b,c){var d=this.game.add.sprite(a+this.startx,b+this.starty,"player atlas",c+".png");return this.game.physics.p2.enable(d,this.debug),d.body.clearShapes(),d.body.loadPolygon("player physics",c),d.body.setCollisionGroup(this.collisionGroups.player.body),d.body.collides(this.collisionGroups.world),this._parts.push(d),d},addDamage:function(a,b,d){var e=a.x+b[0],f=a.y+b[1],g=this.game.add.existing(new c(this.game,e,f,d));this.game.physics.p2.enable(g,!1),g.body.clearShapes(),g.body.addCircle(d),g.body.mass=.01,this.game.physics.p2.createLockConstraint(a,g,b),this.damageSources.push(g)},addJoint:function(a,b,c,d){var e=this.game.physics.p2.createRevoluteConstraint(a,b,c,d);return e.upperLimitEnabled=!0,e.upperLimit=Math.PI/8,e.lowerLimitEnabled=!0,e.lowerLimit=-Math.PI/8,e},processCommandString:function(a){var b,c,d,e,f=this;_.chain(a).groupBy().reduce(function(a,b,c){return a[c]=b.length||0,a},{}).forEach(function(a,g){b=_.contains(g,"left")?f.left:f.right,_.contains(g,"arm")?(c=b.armController,e=[1,3.5,6,9,12,15]):(c=b.legController,e=[1,3,6,9,12,15]),d=_.contains(g,"extend")?"extend":"retract",c[d](e[a-1]||18)})}};var d=new Phaser.Rectangle;Object.defineProperties(b.prototype,{cameraRect:{get:function(){var a,b,c;return _.chain(this._parts).map(function(a){return a.getBounds()}).forEach(function(d,e){0==e?(a=d.left,b=d.top,maxx=d.right,c=d.bottom):(a=Math.min(a,d.left),b=Math.min(b,d.top),maxx=Math.max(maxx,d.right),c=Math.max(c,d.bottom))}),d.setTo(a,b,maxx-a,c-b),d.x+=this.game.camera.x,d.y+=this.game.camera.y,d}}}),c.prototype=Object.create(Phaser.Sprite.prototype),c.prototype.constructor=c,_.extend(c.prototype,{update:function(){this.prev.x=this.body.x,this.prev.y=this.body.y},calculateVelocity:function(){var a=Phaser.Point.distance(this.prev,this.body);return a/game.time.physicsElapsed}}),Object.defineProperty(c.prototype,"circle",{get:function(){return this._circle.x=this.body.x,this._circle.y=this.body.y,this._circle}}),a.PlayerDamage=c,a.Robot=b}(this),function(a){function b(a,b,d,e){Phaser.Sprite.call(this,a,d,e),this.anchor.setTo(.5,.5),a.physics.arcade.enable(this),this.body.setSize(73,256);var f=this.victim=a.add.existing(new c(this.game,0,0,73,256));this.addChild(f),_.extend(this.events,{onDamage:new Phaser.Signal,onCommandPause:new Phaser.Signal,onCommandResume:new Phaser.Signal}),this._startY=e,this._facing=Phaser.LEFT,this._state="none",this._touchedGround=!1,this._acceptCommands=!0,this.idle();var g=!0;a.input.keyboard.addKey(Phaser.Keyboard.T).onDown.add(function(){switch(this.state){case"idle":g?(this.advance(-50),g=!1):(this.retreat(50),g=!0);break;case"retreating":case"advancing":this.idle()}},this),a.input.keyboard.addKey(Phaser.Keyboard.U).onDown.add(function(){this.knockback(-200,-300)},this)}function c(a,b,c,d,e){Phaser.Sprite.call(this,a,b,c),this.anchor.setTo(.5,.5),a.physics.arcade.enable(this),this.body.setSize(d,e),this._square=new Phaser.Rectangle(b,c,d,e)}_.extend(b,{Knockback:{Gravity:300,TurnThreshold:20},WakeUp:{Time:1.5},StandUp:{Time:500},Distance:{Far:700,Mid:300,Near:150},Move:{Speed:150},preload:function(a){a.atlasJSONArray("enemy-atlas","assets/enemy.b849b5f8.png","assets/enemy.f871be15.json"),a.atlasJSONArray("enemy-extra-atlas","assets/enemy extra.11ff6cd6.png","assets/enemy extra.f75f9dbc.json")}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,_.extend(b.prototype,{update:function(){switch(this.state){case"knocked back":this.body.velocity.y>-b.Knockback.TurnThreshold&&(this.animations.play("fall-back"),this.body.setSize(284,42,0,30),this.body.bounce.setTo(.3,.3),this.state="falling");break;case"waking up":this._wakeUpTimer+=this.game.time.physicsElapsed,this._wakeUpTimer>=b.WakeUp.Time&&this.stand()}},onCollision:function(){switch(this.state){case"falling":case"waking up":this.body.velocity.x=.7*this.body.velocity.x,this._touchedGround||(this._touchedGround=!0,this.wakeUp())}},idle:function(){switch(this.state){case"idle":return;case"none":case"standing":this.doIdle();break;case"advancing":this.acceptCommands=!1,this.animations.play("stop-advance").onComplete.addOnce(function(){this.acceptCommands=!0,this.doIdle()},this);break;case"retreating":this.acceptCommands=!1,this.animations.play("stop-retreat").onComplete.addOnce(function(){this.acceptCommands=!0,this.doIdle()},this)}},advance:function(a){switch(this.state){case"advancing":return;case"none":case"idle":this.doAdvance(a);break;case"retreating":this.acceptCommands=!1,this.animations.play("stop-retreat").onComplete.addOnce(function(){this.acceptCommands=!0,this.doAdvance(a)},this),this.body.velocity.x=a}},retreat:function(a){switch(this.state){case"retreating":return;case"none":case"idle":this.doRetreat(a);break;case"advancing":this.acceptCommands=!1,this.animations.play("stop-advance").onComplete.addOnce(function(){this.acceptsCommands=!0,this.doRetreat(a)},this),this.body.velocity.x=a}},knockback:function(a,c){this.acceptCommands=!1,this.switchToMainAtlas(),this.setFacing(-a),this.animations.play("knocked-up"),this.body.velocity.setTo(a,c),this.body.acceleration.y=b.Knockback.Gravity,this._touchedGround=!1,this.state="knocked back"},wakeUp:function(){this._wakeUpTimer=0,this.state="waking up"},stand:function(){"waking up"==this.state&&(this.body.velocity.setTo(0,0),this.body.acceleration.y=0,this.game.add.tween(this).to({y:this._startY},b.StandUp.Time).start(),this.switchToExtraAtlas(),this.animations.play("stand").onComplete.addOnce(function(){this.acceptsCommands=!0,this.body.setSize(73,256,0,0),this.idle()},this),this.state="standing")},doIdle:function(){this.switchToMainAtlas(),this.animations.play("idle"),this.body.velocity.x=0,this.state="idle"},doAdvance:function(a){this.switchToMainAtlas(),this.setFacing(a),this.animations.play("start-advance").onComplete.addOnce(function(){this.animations.play("advancing")},this),this.body.velocity.x=a,this.state="advancing"},doRetreat:function(a){this.switchToMainAtlas(),this.setFacing(-a),this.animations.play("start-retreat").onComplete.addOnce(function(){this.animations.play("retreating")},this),this.body.velocity.x=a,this.state="retreating"},setFacing:function(a){0>a?(this.scale.x=1,this.facing=Phaser.LEFT):(this.scale.x=-1,this.facing=Phaser.RIGHT)},switchToMainAtlas:function(){"enemy-atlas"!==this.key&&(this.loadTexture("enemy-atlas"),this.anchor.setTo(.5,.5),this.animations.add("idle",Phaser.Animation.generateFrameNames("idle__",0,9,".png",3),10,!0),this.animations.add("start-advance",Phaser.Animation.generateFrameNames("advance__",0,2,".png",3),10),this.animations.add("advancing",Phaser.Animation.generateFrameNames("advance__",3,5,".png",3),10,!0),this.animations.add("stop-advance",Phaser.Animation.generateFrameNames("advance__",2,0,".png",3),10),this.animations.add("start-retreat",Phaser.Animation.generateFrameNames("retreat__",0,2,".png",3),10),this.animations.add("retreating",Phaser.Animation.generateFrameNames("retreat__",3,5,".png",3),10,!0),this.animations.add("stop-retreat",Phaser.Animation.generateFrameNames("retreat__",2,0,".png",3),10),this.animations.add("knocked-up",["knockback__000.png"],1,!0),this.animations.add("fall-back",Phaser.Animation.generateFrameNames("knockback__",0,5,".png",3),10),this.animations.add("fallen",["knockback__005.png"],1,!0),this.animations.add("start-cast",Phaser.Animation.generateFrameNames("wave_attack__",0,5,".png",3),10),this.animations.add("casting",["wave_attack__005.png"],1,!0),this.animations.add("stop-cast",Phaser.Animation.generateFrameNames("wave_attack__",5,0,".png",3),10))},switchToExtraAtlas:function(){"enemy-extra-atlas"!==this.key&&(this.loadTexture("enemy-extra-atlas"),this.anchor.setTo(.5,.5),this.animations.add("slash",Phaser.Animation.generateFrameNames("slash__",0,7,".png",3),5),this.animations.add("stand",Phaser.Animation.generateFrameNames("stand__",0,7,".png",3),10))}});var d=new Phaser.Rectangle;Object.defineProperties(b.prototype,{state:{get:function(){return this._state},set:function(a){this.prevState=this._state,this._state=a}},acceptCommands:{get:function(){return this._acceptCommands},set:function(a){a!=this._acceptCommands&&(a?this.events.onCommandResume.dispatch(this):this.events.onCommandPause.dispatch(this),this._acceptCommands=a)}},cameraRect:{get:function(){var a=this.getBounds();return d.copyFrom(a),d.x+=this.game.camera.x,d.y+=this.game.camera.y,d}}}),c.prototype=Object.create(Phaser.Sprite.prototype),c.prototype.constructor=c,Object.defineProperty(c.prototype,"rect",{get:function(){return this._square.x=this.body.x,this._square.y=this.body.y,this._square}}),a.Enemy=b}(this),function(a){function b(a){this.player=a,this._rect=new Phaser.Rectangle}b.prototype={update:function(){this._rect.copyFrom(this.player.cameraRect)}},Object.defineProperties(b.prototype,{x:{get:function(){return this._rect.centerX}},y:{get:function(){return this._rect.centerY}},left:{get:function(){return this._rect.left}},right:{get:function(){return this._rect.right}}}),a.PlayerSensor=b}(this),function(a){function b(){this.onStart=new Phaser.Signal,this.onComplete=new Phaser.Signal}function c(a,c){this.agent=a,this.sensor=c,this.started=!1,this.events=new b}c.prototype={update:function(){this.started||(this.start(),this.started=!0,this.events.onStart.dispatch(this)),this.think()},start:function(){},think:function(){},complete:function(){this.events.onComplete.dispatch(this)}},a.Action=c}(this),function(a){function b(a,b){Action.call(this,a),this.delay=b,this.timer=0}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){this.agent.idle()},think:function(){this.timer+=this.agent.game.time.physicsElapsed,this.timer>this.delay&&this.complete()}}),a.WaitAction=b}(this),function(a){function b(a,b){Action.call(this,a,b)}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){var a=this.agent,b=this.sensor,c=b.x<a.x?-Enemy.Move.Speed:Enemy.Move.Speed;a.advance(c)},think:function(){var a=this.agent,b=this.sensor;b.right+Enemy.Distance.Near>a.x&&(a.idle(),this.events.onComplete.dispatch(this))}}),a.GoNearAction=b}(this),function(a){function b(a,b){Action.call(this,a,b)}b.Slop=10,b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){var a=this.agent,c=this.sensor,d=a.x>c.x?Phaser.RIGHT:Phaser.LEFT;this.side=d,d==Phaser.RIGHT?a.x<c.right+Enemy.Distance.Mid-b.Slop?a.retreat(Enemy.Move.Speed):a.advance(-Enemy.Move.Speed):a.x<c.left-Enemy.Distance.Mid+b.Slop?a.advance(-Enemy.Move.Speed):a.retreat(Enemy.Move.Speed)},think:function(){var a=this.agent,c=this.sensor;(this.side==Phaser.RIGHT&&Math.abs(c.right+Enemy.Distance.Mid-a.x)<b.Slop||Math.abs(c.left-Enemy.Distance.Mid-a.x)<b.Slop)&&this.complete()}}),a.GoMidAction=b}(this),function(a){function b(a,b){Action.call(this,a,b)}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){var a=this.agent,b=this.sensor,c=a.x<b.x?-Enemy.Move.Speed:Enemy.Move.Speed;a.retreat(c)},think:function(){var a=this.agent,b=this.sensor;b.left+Enemy.Distance.Far<a.x&&this.events.onComplete.dispatch(this)}}),a.GoFarAction=b}(this),function(a){function b(a,b,c){this.acceptsCommands=!0,this.thinking=!1,this.enemy=b,this.player=a,this.sensor=new PlayerSensor(a),this.rnd=c,this.actionQueue=[]}b.prototype={weightedSelect:function(a,b){for(var c=_.reduce(a,function(a,b){return a+b}),d=this.rnd.integerInRange(0,c),e=0,f=0;c>e;){if(e+=a[f],e>d)return b[f];f++}return b[b.length-1]},update:function(){if(this.sensor.update(),this.actionQueue.length>0){var a=this.actionQueue[0];a.update()}},chooseNextAction:function(){var a=this.weightedSelect([2,3,2,1],["near","mid","far","pause"]);this.pushAction(a)},pushAction:function(a){var b=this.createAction(a);this.actionQueue.push(b),b.events.onComplete.addOnce(this.onActionComplete,this)},createAction:function(a){switch(a){case"near":return new GoNearAction(this.enemy,this.sensor);case"mid":return new GoMidAction(this.enemy,this.sensor);case"far":return new GoFarAction(this.enemy,this.sensor);case"pause":return new WaitAction(this.enemy,.3)}},onActionComplete:function(){this.prevAction=this.actionQueue.shift(),0===this.actionQueue.length&&this.chooseNextAction()},onMatchStart:function(){this.chooseNextAction()},onCommandPause:function(){this.acceptsCommands=!1},onCommandResume:function(){this.acceptsCommands=!0,0===this.actionQueue.length&&chooseNextAction()}},a.EnemyController=b}(this),function(a){function b(a,c,d,e){Phaser.Sprite.call(this,a,c,d),this.anchor.setTo(.5,.5),this.fighters=e;var f=b.Bounds.Width,g=b.Bounds.Height;this.rects=_.map(e,function(a){return new Phaser.Rectangle(a.x-f/2,a.y-g/2,f,g)},this),a.physics.arcade.enable(this),this.target=new Phaser.Rectangle(c,d,800,600)}var c=new Phaser.Point,d=new Phaser.Point;_.extend(b,{Bounds:{Width:200,Height:400,Padding:25},Spring:{Stiffness:100,Damping:50}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,_.extend(b.prototype,{update:function(){var a=this.rects,e=this.fighters,f=this.target;f.x=f.y=0;for(var g=0;g<e.length;g++)a[g].copyFrom(e[g].cameraRect),f.x+=a[g].centerX,f.y+=a[g].centerY;f.x=f.x/e.length-400,f.y=f.y/e.length-300,first=a[0],f.left>first.left?f.x=first.left:f.right<first.right&&(f.x=first.right-800),f.top>first.top?f.y=first.top:f.bottom<first.bottom&&(f.y=first.bottom-600),c.setTo(f.centerX,f.centerY),Phaser.Point.subtract(c,this.body.position,c),c.multiply(b.Spring.Stiffness,b.Spring.Stiffness),d.copyFrom(this.body.velocity),d.multiply(b.Spring.Damping,b.Spring.Damping),Phaser.Point.subtract(c,d,this.body.acceleration)}}),a.FightCamera=b}(this),function(a){function b(a,b,c,d){Phaser.Sprite.call(this,a,b,c,"hp-guages","guage-bg"),this.fixedToCamera=!0;var e=this._guage=a.make.sprite(0,1,"hp-guages",d+"-hp-guage"),f=a.make.sprite(-3,-3,"hp-guages",d+"-hp-guage-overlay");this.addChild(e),this.addChild(f);var g=this._rect=new Phaser.Rectangle(0,0,e.width,e.height);e.crop(g)}_.extend(b,{preload:function(a){a.atlasJSONHash("hp-guages","assets/health guages.6a590e3b.png","assets/health guages.49b6760a.json")}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,_.extend(b.prototype,{}),a.HealthBar=b}(this),function(a){function b(a,b,c){Phaser.Sprite.call(this,a,b,c,"timer-bar-bg");var d=this._bar=a.make.sprite(0,0,"timer-bar"),e=this._rect=new Phaser.Rectangle(0,0,1,this.height);this.addChild(d),d.crop(e)}_.extend(b,{preload:function(a){a.image("timer-bar-bg","assets/timer bar bg.7000549c.png"),a.image("timer-bar","assets/timer bar.35ceeabe.png")}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,Object.defineProperties(b.prototype,{value:{set:function(a){a=Math.max(0,a),a=Math.min(1,a),this._rect.width=Math.floor(this.width*a),this._bar.crop(this._rect)}}}),a.TimerBar=b}(this),function(a){function b(a,b,c){Phaser.Group.call(this,a),_.extend(this,{commandKeyPool:b,commandsToKeyCodes:c});var d=this.timerBar=this.add(new TimerBar(a,-50,18));d.visible=!1,d.value=0}_.extend(b,{Spacing:{Height:32,Gap:4},Tween:{Duration:500},CommandLifetime:3e3,preload:function(){}}),b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,_.extend(b.prototype,{moveAllUp:function(){var a,c=b.Spacing.Height+b.Spacing.Gap;this.forEach(function(d){d instanceof CommandString&&(a=d.y-c,this.game.add.tween(d).to({y:a},b.Tween.Duration).start())},this)},onStringStart:function(){var a=new CommandString(this.game,this.commandKeyPool,this.x,this.y);this.add(a),this.workingString=a,this.timerBar.visible=!0},onStringEnd:function(){this.workingString.fadeOut(b.CommandLifetime),this.workingString=void 0,this.moveAllUp(),this.timerBar.visible=!1},onCommand:function(a){if(this.workingString){var b=this.commandsToKeyCodes[a];b?this.workingString.addKey(b):console.error('cannot find keycode for command "'+a+'"')}},onTimerChanged:function(a,b,c){this.timerBar.value=c}}),a.CommandDisplay=b}(this),function a(b){function a(a){Phaser.Group.call(this,a);var b=this.pages=[a.make.sprite(0,0,"instructions-page-1"),a.make.sprite(0,0,"instructions-page-2")];_.forEach(b,function(b){this.add(b),b.anchor.setTo(.5,.5),b.position.setTo(a.width/2,a.height/2),b.visible=!1},this),this.currentPage=0,b[0].visible=!0,_.extend(this.events,{onComplete:new Phaser.Signal});var c=this.advanceKey=a.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);c.onDown.add(this.advance,this)}_.extend(a,{preload:function(a){a.image("instructions-page-1","assets/instructions for keys.6983c503.png"),a.image("instructions-page-2","assets/instructions for strings.a22ef008.png")}}),a.prototype=Object.create(Phaser.Group.prototype),a.prototype.constructor=a,Mixin.create({destroy:function(){this.advanceKey.onDown.remove(this.advance,this),this.__super.apply(this,arguments)},advance:function(){var a=this.pages,b=this.currentPage;newPage=this.currentPage+1,a[b].visible=!1,newPage>=a.length?this.destroy():(a[newPage].visible=!0,this.currentPage=newPage)}})(a.prototype),b.Instructions=a}(this),function(a){function b(){}b.prototype={preload:function(){this.load.image("loading-bar","assets/loading bar.f44b1a70.png"),this.load.image("loading-bar-bg","assets/loading bar bg.1fe86dc8.png")},create:function(){this.state.start("preload")}},a.Boot=b}(this),function(a){function b(){}b.prototype={preload:function(){var a=250,b=296,c=this.add,d=this.load;c.sprite(a,b,"loading-bar-bg");var e=c.sprite(a,b,"loading-bar");d.setPreloadSprite(e),d.bitmapFont("minecraftia","assets/minecraftia.d0c5b06a.png","assets/minecraftia.22ff6d4c.xml"),Robot.preload(d),Ground.preload(d),CommandKeyPool.preload(d),TimerBar.preload(d),CommandDisplay.preload(d),Instructions.preload(d),HealthBar.preload(d),Enemy.preload(d),d.onLoadComplete.addOnce(this.onLoadComplete,this)},create:function(){this.stage.backgroundColor="#000000"},onLoadComplete:function(){this.state.start("game")}},a.Preload=b}(this),function(a){function b(){}b.prototype={create:function(){var a=this.game.physics,b=this.add,c=!1;this.game.stage.setBackgroundColor("#6495ED"),this.world.setBounds(-800,-1200,2400,1800),a.startSystem(Phaser.Physics.P2JS),a.p2.gravity.y=300;var d={world:a.p2.createCollisionGroup(),player:{body:a.p2.createCollisionGroup(),damage:a.p2.createCollisionGroup(),victim:a.p2.createCollisionGroup()},enemy:{body:a.p2.createCollisionGroup(),damage:a.p2.createCollisionGroup(),victim:a.p2.createCollisionGroup()}},e=(this.ground=b.existing(new Ground(this.game,d,568)),this.robot=new Robot(this.game,d,200,300,c)),f=this.enemy=b.existing(new Enemy(this.game,d,600,350)),g=this.dolly=b.existing(new FightCamera(this.game,400,300,[e,f]));this.camera.follow(g);var h=this.enemyController=new EnemyController(e,f,this.game.rnd);h.onMatchStart(),b.existing(new HealthBar(this.game,20,20,"player")),b.existing(new HealthBar(this.game,440,20,"enemy"));var i=this.commandBuffer=new CommandBuffer(this.game),j=this.commandKeyPool=new CommandKeyPool(this.game),k=this.commandDisplay=new CommandDisplay(this.game,j,i.commandsToKeyCodes);k.x=200,k.y=275,k.timerBar.x=135,k.timerBar.y=292,k.fixedToCamera=!0,i.events.onStringEnd.add(e.processCommandString,e),i.events.onStringStart.add(k.onStringStart,k),i.events.onCommand.add(k.onCommand,k),i.events.onStringEnd.add(k.onStringEnd,k),i.events.onTimerChanged.add(k.onTimerChanged,k),f.events.onCommandPause.add(function(){console.log("commands paused")}),f.events.onCommandResume.add(function(){console.log("commands resumed")})},update:function(){this.commandBuffer.update(),this.enemyController.update(),_.forEach(this.robot.damageSources,function(a){var b=a.calculateVelocity();b>600&&SAT.circleVsRect(a.circle,this.enemy.victim.rect)&&console.log(b)},this),this.game.physics.arcade.collide(this.enemy,this.ground.arcade,void 0,this.enemy.onCollision,this.enemy)},render:function(){}},a.Game=b}(this);var game=new Phaser.Game(800,600,Phaser.AUTO,"game-container");game.state.add("boot",Boot),game.state.add("preload",Preload),game.state.add("game",Game),game.state.start("boot");