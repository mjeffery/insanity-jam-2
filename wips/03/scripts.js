!function(a){a.Util={override:function(a,b,c){var d=a[b];a[b]=function(){var a=this.__super;this.__super=d;var b=c.apply(this,arguments);return this.__super=a,b}}}}(this),function(a){function b(a,b){return function(c){for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];c[d]&&"function"==typeof e?Util.override(c,d,e):c[d]=e}void 0!==b&&Object.defineProperties(c,b)}}a.Mixin={create:b}}(this),function(a){function b(a){this._callbacks=[],a.physics.p2.setPostBroadphaseCallback(this.callback,this)}b.prototype={callback:function(a,b){for(var c,d,e,f=!1,g=this._callbacks||[],h=0;h<g.length;h++)d=g[h].fn,c=g[h].ctx||{},(!f||g[h].always)&&(e=d.call(c,a,b),f||(f=!e));return!f},addCallback:function(a,b,c){this._callbacks.push({fn:a,ctx:b,always:c})}},a.PostBroadphaseProcessor=b}(this),function(a){new Phaser.Point;a.SAT={circleVsRect:function(a,b){return a.x-a.radius>b.right?!1:a.x+a.radius<b.left?!1:a.y-a.radius>b.bottom?!1:a.y+a.radius<b.top?!1:!0}}}(this),function(a){function b(a){_.extend(this,{game:a,keyboard:a.input.keyboard,keys:{},events:{onCommand:new Phaser.Signal,onStringStart:new Phaser.Signal,onTimerChanged:new Phaser.Signal,onStringEnd:new Phaser.Signal},_inputEnabled:!1,_stringTimer:0,_stringTimerMax:1,keyTimer:0,keyTimerMax:.333,state:"waiting",enabled:!0,buffer:[]}),this.mapKey(Phaser.Keyboard.A,"left arm extend"),this.mapKey(Phaser.Keyboard.S,"left arm retract"),this.mapKey(Phaser.Keyboard.D,"left leg extend"),this.mapKey(Phaser.Keyboard.F,"left leg retract"),this.mapKey(Phaser.Keyboard.COLON,"right arm extend"),this.mapKey(Phaser.Keyboard.L,"right arm retract"),this.mapKey(Phaser.Keyboard.K,"right leg extend"),this.mapKey(Phaser.Keyboard.J,"right leg retract")}_.extend(b.prototype,{update:function(){if("in string"===this.state){var a=this.game.time.physicsElapsed;this.keyTimer+=a,this.stringTimer+=a,(this.keyTimer>=this.keyTimerMax||this.stringTimer>=this.stringTimerMax)&&this.endString()}},startString:function(){this.events.onStringStart.dispatch(this),this.stringTimer=0,this.state="in string"},endString:function(){var a=this.buffer;this.buffer=[],this.events.onStringEnd.dispatch(a,this),this.state="waiting"},pushCommand:function(a){"waiting"===this.state&&this.startString(),this.buffer.push(a),this.keyTimer=0,this.events.onCommand.dispatch(a,this)},timerChanged:function(){var a=this.stringTimer,b=this.stringTimerMax,c=0===b?0:a/b;this.events.onTimerChanged.dispatch(a,b,c,this)},mapKey:function(a,b){var c=this.keyboard.addKey(a);this.keys[a]={key:c,command:b},c.onDown.add(this.onKeyDown,this)},onKeyDown:function(a){if(this._inputEnabled){var b=this.keys[a.keyCode];b&&this.pushCommand(b.command)}},onInputEnabled:function(){this._inputEnabled=!0},onInputDisabled:function(){this._inputEnabled=!1}}),Object.defineProperties(b.prototype,{stringTimer:{get:function(){return this._stringTimer},set:function(a){a=Math.max(a,0),a=Math.min(a,this.stringTimerMax),this._stringTimer!==a&&(this._stringTimer=a,this.timerChanged())}},stringTimerMax:{get:function(){return this._stringTimerMax},set:function(){newMax=Math.max(0,newMax),newMax!==this._stringTimerMax&&(this._stringTimerMax=newMax,this._stringTimer>newMax&&(this._stringTimer=newMax),this.timerChanged())}},commandsToKeyCodes:{get:function(){return _.chain(this.keys).mapValues("command").invert().value()}}}),a.CommandBuffer=b}(this),function(a){function b(a,b){Phaser.Group.call(this,a),void 0===b&&(b=50),this.createMultiple(b,"command-keys");var c=[Phaser.Keyboard.A,Phaser.Keyboard.S,Phaser.Keyboard.D,Phaser.Keyboard.F,Phaser.Keyboard.J,Phaser.Keyboard.K,Phaser.Keyboard.L,Phaser.Keyboard.COLON];this.codesToFrames=_.reduce(c,function(a,b,c){return a[b]=c,a},{})}_.extend(b,{preload:function(a){a.spritesheet("command-keys","assets/command keys.956c5489.png",32,32,8)}}),b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,_.extend(b.prototype,{obtain:function(a){var b=this.getFirstDead(),c=this.codesToFrames[a];return this.remove(b,!1,!0),b.reset(0,-16),b.alpha=1,b.frame=c,b},release:function(a){a.kill(),this.add(a)}}),a.CommandKeyPool=b}(this),function(a){function b(a,b,c,d){Phaser.Group.call(this,a),_.extend(this,{commandKeyPool:b,x:c||0,y:d||0})}_.extend(b,{Spacing:{Width:32,Gap:2},Fade:{Duration:1500}}),b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,_.extend(b.prototype,{addKey:function(a){var b=this.commandKeyPool.obtain(a);this.add(b),this.recenter()},recenter:function(){var a=this.countLiving();if(0!==a){var c=a*b.Spacing.Width+(a-1)*b.Spacing.Gap,d=-c/2,e=b.Spacing.Width+b.Spacing.Gap;this.forEachAlive(function(a){a.position.x=d,d+=e})}},fadeOut:function(a){this.forEach(function(c){this.game.add.tween(c).to({alpha:0},b.Fade.Duration,void 0,!0,a).onComplete.addOnce(this._onComplete,this)},this)},_onComplete:function(a){this.remove(a),this.commandKeyPool.release(a)}}),a.CommandString=b}(this),function(a){function b(a,b,c,d){_.extend(this,{_state:"none",events:{onStateChange:new Phaser.Signal},torso:{joint:a,options:_.defaults(b||{},{extended:{limit:-Math.PI/8,motorDir:1,scale:1},retracted:{limit:3*Math.PI/4,motorDir:-1,scale:1}})},limb:{joint:c,options:_.defaults(d||{},{extended:{limit:-Math.PI/8,motorDir:1,scale:1},retracted:{limit:3*Math.PI/4,motorDir:-1,scale:1}})}})}var c=.1;b.prototype={extend:function(a){switch(this.state){case"none":case"extending":case"retracting":case"retracted":this.doExtend(a);break;case"relaxed":this.restoreExtended()}},retract:function(a){switch(this.state){case"none":case"extending":case"extended":case"retracting":this.doRetract(a);break;case"relaxed":this.restoreRetracted()}},relax:function(){var a=this.limb,b=this.torso;this.relaxJoint(b.joint,b.options.relaxed),this.relaxJoint(a.joint,a.options.relaxed),this.state="relaxed"},restoreExtended:function(){var a=this.limb,b=this.torso;this.restoreJoint(a.joint,a.options.extended),this.restoreJoint(b.joint,b.options.extended),this.nextState="extended",this.state="restoring"},restoreRetracted:function(){var a=this.limb,b=this.torso;this.restoreJoint(a.joint,a.options.retracted),this.restoreJoint(b.joint,b.options.retracted),this.nextState="retracted",this.state="restoring"},update:function(){var a=this.limb,b=this.torso;if(this.updateJoint(a),this.updateJoint(b),a.relaxed&&b.relaxed)switch(this.state){case"extending":this.state="extended";break;case"retracting":this.state="retracted";break;case"restoring":this.state=this.nextState}},doExtend:function(a){var b=this.limb,c=this.torso;this.driveJoint(c.joint,a,c.options.extended),this.driveJoint(b.joint,a,b.options.extended),this.state="extending"},doRetract:function(a){var b=this.limb,c=this.torso;this.driveJoint(c.joint,a,c.options.retracted),this.driveJoint(b.joint,a,b.options.retracted),this.state="retracting"},restoreJoint:function(a,b){a.motorIsEnabled()||a.enableMotor(),a.angle>b.limit?(a.lowerLimit=b.limit,a.setMotorSpeed(2)):(a.upperLimit=b.limit,a.setMotorSpeed(-2))},updateJoint:function(a){var b=a.joint;b.motorIsEnabled()&&(b.getMotorSpeed()>0&&Math.abs(b.angle-b.lowerLimit)<c?(b.setMotorSpeed(.5),a.relaxed=!0):b.getMotorSpeed()<0&&Math.abs(b.angle-b.upperLimit)<c?(b.setMotorSpeed(-.5),a.relaxed=!0):a.relaxed=!1)},driveJoint:function(a,b,c){c.motorDir>0?a.lowerLimit=c.limit:a.upperLimit=c.limit,a.motorIsEnabled()||a.enableMotor(),a.setMotorSpeed(b*c.motorDir)},relaxJoint:function(a,b){a.lowerLimit=b.lowerLimit||-Math.PI/8,a.upperLimitEnabled=b.upperLimit||Math.PI/8,a.motorIsEnabled()&&a.disableMotor()},mirror:function(a,c){function d(a){return{limit:-a.limit,motorDir:-a.motorDir}}function e(a){return{retracted:d(a.retracted),extended:d(a.extended),relaxed:{lowerLimit:-a.relaxed.upperLimit,upperLimit:-a.relaxed.lowerLimit}}}return new b(a,e(this.torso.options),c,e(this.limb.options))}},Object.defineProperties(b.prototype,{state:{get:function(){return this._state},set:function(a){if(a!==this._state){var b=this._state;this._state=a,this.events.onStateChange.dispatch(a,b)}}}}),a.LimbController=b}(this),function(a){function b(a,b,c,d,e){Phaser.TileSprite.call(this,a,a.world.bounds.centerX,d,a.world.bounds.width,64,"dirt",0),a.physics.p2.enable(this,e),this.body.setRectangleFromSprite(this),this.body.static=!0,this.body.setCollisionGroup(b.world),this.body.collides([b.player.body,b.enemy.magic]),this.body.setMaterial(c.world);var f=this.arcade=a.make.sprite(a.world.bounds.left,d-32);a.physics.arcade.enable(f),f.body.setSize(a.world.bounds.width,64),f.body.immovable=!0}_.extend(b,{preload:function(a){a.image("dirt","assets/dirt.f386c547.png")}}),b.prototype=Object.create(Phaser.TileSprite.prototype),b.prototype.constructor=b,a.Ground=b}(this),function(a){a.HasHpMixin=Mixin.create({initialize:function(a){void 0===a&&(a=100),this.events||(this.events={}),_.extend(this.events,{onDamage:new Phaser.Signal,onDefeated:new Phaser.Signal}),_.extend(this,{_hp:a,_maxHp:a})}},{hp:{get:function(){return this._hp},set:function(a){var b=this._hp;this._hp=a,b>a&&this.events.onDamage.dispatch(this._hp,this._maxHp),0>=a&&this.events.onDefeated.dispatch(this)}}})}(this),function(a){function b(a,b,c,d,e,f){a.physics;_.extend(this,{game:a,debug:!!f,events:{onInputEnabled:new Phaser.Signal,onInputDisabled:new Phaser.Signal,onBlockStatus:new Phaser.Signal},collisionGroups:b,materials:c,_damageEnabled:!0,_inputEnabled:!1,_invincible:!1,_invincibilityTimer:0,_asleep:!1,_wakeUpTimer:0,_tightening:!1,blocking:{right:!1,left:!1}}),this.initialize(100),this._parts=[];var g=this.left={},h=this.right={};this.startx=(d||0)-324,this.starty=(e||0)-234,this._temp={circle:{x:0,y:0,radius:0},rect:new Phaser.Rectangle},g.thigh=this.addPart(305,331,"robot left thigh",!0),h.thigh=this.addPart(348,332,"robot right thigh",!0),g.arm=this.addPart(275,218,"robot left arm"),h.arm=this.addPart(372,218,"robot right arm");var i=this.torso=this.addPart(324,234,"robot chest",!0),j=this.head=this.addPart(325,171,"robot head");g.foot=this.addPart(290,420,"robot left boot",!0),h.foot=this.addPart(361,420,"robot right boot",!0),g.hand=this.addPart(266,214,"robot left fist"),h.hand=this.addPart(382,214,"robot right fist"),g.knee=this.addJoint(g.foot,[14.5,-37.5],g.thigh,[1,51.5]),h.knee=this.addJoint(h.foot,[-14.5,-37.5],h.thigh,[-1,51.5]),g.hip=this.addJoint(g.thigh,[-1,-50.5],i,[-19,46.5]),h.hip=this.addJoint(h.thigh,[1,-50.5],i,[27,46.5]),g.shoulder=this.addJoint(g.arm,[28.5,-13],i,[-28,-38.5]),h.shoulder=this.addJoint(h.arm,[-28.5,-13],i,[27,-38.5]),g.elbow=this.addJoint(g.hand,[-18.5,36.5],g.arm,[-37.5,19]),h.elbow=this.addJoint(h.hand,[18.5,36.5],h.arm,[37.5,19]),this.neck=this.addJoint(i,[0,-63.5],j,[0,0]),this._coreParts=[i],this.damageSources=[],this.addDamage(g.hand,[-2,21],20),this.addDamage(h.hand,[3,20],20),this.addDamage(g.foot,[0,-15],30),this.addDamage(h.foot,[0,-15],30),g.legController=new LimbController(g.hip,{retracted:{limit:-3*Math.PI/4,motorDir:1},extended:{limit:0,motorDir:-1},relaxed:{lowerLimit:-3*Math.PI/4,upperLimit:Math.PI/2}},g.knee,{retracted:{limit:3*Math.PI/4,motorDir:-1},extended:{limit:0,motorDir:1},relaxed:{lowerLimit:0,upperLimit:3*Math.PI/4}}),g.armController=new LimbController(g.shoulder,{retracted:{limit:5*Math.PI/16,motorDir:-1},extended:{limit:-3*Math.PI/16,motorDir:1},relaxed:{lowerLimit:-Math.PI/4,upperLimit:5*Math.PI/16}},g.elbow,{retracted:{limit:-2*Math.PI/8,motorDir:2},extended:{limit:3*Math.PI/4,motorDir:-2},relaxed:{lowerLimit:-2*Math.PI/8,upperLimit:3*Math.PI/4}}),h.legController=g.legController.mirror(h.hip,h.knee),h.armController=g.armController.mirror(h.shoulder,h.elbow),this.controllers=[h.legController,h.armController,g.legController,g.armController],h.armController.events.onStateChange.add(this.onRightArmStateChange,this),g.armController.events.onStateChange.add(this.onLeftArmStateChange,this),this.tighten();var k=this.bodyRect,l=this.arcade=a.add.sprite(k.x,k.y);a.physics.arcade.enable(l),l.body.setSize(k.width,k.height)}function c(a,b){var c,d,e;_.chain(a).map(function(a){return a.getBounds()}).forEach(function(a,b){0==b?(c=a.left,d=a.top,maxx=a.right,e=a.bottom):(c=Math.min(c,a.left),d=Math.min(d,a.top),maxx=Math.max(maxx,a.right),e=Math.max(e,a.bottom))}),b.setTo(c,d,maxx-c,e-d),b.x+=this.game.camera.x,b.y+=this.game.camera.y}function d(a,b,c,d){Phaser.Sprite.call(this,a,b,c),this.prev={x:b,y:c},this.visible=!1,this._circle={x:b,y:c,radius:d}}_.extend(b,{Attack:{Speed:{Min:600,Max:2e3}},Invincibility:{Duration:1},WakeUp:{Duration:2},Magic:{UpwardForce:1e4},preload:function(a){a.atlasJSONArray("player atlas","assets/player.4378e24f.png","assets/player.92040224.json"),a.physics("player physics","assets/new robot.d74bf7a5.json")}}),b.prototype={update:function(){var a=this.bodyRect;if(this.arcade.body.x=a.x,this.arcade.body.y=a.y,this.arcade.body.setSize(a.width,a.height),this._invincible&&(this._invincibilityTimer-=this.game.time.physicsElapsed,this._invincibilityTimer<=0&&(this._invincible=!1)),this._asleep)this._wakeUpTimer-=this.game.time.physicsElapsed,this._wakeUpTimer<=0&&(this._asleep=!1,this._tightening=!0,this.tighten());else if(this._tightening){var b=!1;_.forEach(this.controllers,function(a){"restoring"===a.state&&(b=!0)}),b||(this._tightening=!1,this.inputEnabled=!0)}_.forEach(this.controllers,function(a){a.update()})},addPart:function(a,b,c,d){var e=this.game.add.sprite(a+this.startx,b+this.starty,"player atlas",c);return this.game.physics.p2.enable(e,this.debug),e.body.clearShapes(),e.body.loadPolygon("player physics",c),e.body.setCollisionGroup(this.collisionGroups.player.body),e.body.setMaterial(this.materials.robot),e.body.collides(this.collisionGroups.world),d&&(e.body.collides(this.collisionGroups.enemy.damage,this.onCollideFist,this),e.body.collides(this.collisionGroups.enemy.blocked,this.onCollideBlocked,this),e.body.collides(this.collisionGroups.enemy.magic,this.onCollideMagic,this)),this._parts.push(e),e},addDamage:function(a,b,c){var e=a.x+b[0],f=a.y+b[1],g=this.game.add.existing(new d(this.game,e,f,c));this.game.physics.p2.enable(g,!1),g.body.clearShapes(),g.body.addCircle(c),g.body.mass=.01,this.game.physics.p2.createLockConstraint(a,g,b),this.damageSources.push(g)},addJoint:function(a,b,c,d){var e=this.game.physics.p2.createRevoluteConstraint(a,b,c,d);return e.upperLimitEnabled=!0,e.upperLimit=Math.PI/8,e.lowerLimitEnabled=!0,e.lowerLimit=-Math.PI/8,e},processCommandString:function(a){if(this._inputEnabled){var b,c,d,e,f=this;_.chain(a).groupBy().reduce(function(a,b,c){return a[c]=b.length||0,a},{}).forEach(function(a,g){b=_.contains(g,"left")?f.left:f.right,_.contains(g,"arm")?(c=b.armController,e=[1,4.5,6,9,12,15]):(c=b.legController,e=[1,3,6,9,12,15]),d=_.contains(g,"extend")?"extend":"retract",c[d](e[a-1]||18)})}},takeDamage:function(a){this._invincible||(this.relax(),this._damageEnabled=!1,this.inputEnabled=!1,this.hp-=a||0,this.startInvincibility(),this.startWakeUp())},chipDamage:function(a){this._invincible||(this.hp-=a||0,this.startInvincibility(.2))},relax:function(){this.left.armController.relax(),this.left.legController.relax(),this.right.armController.relax(),this.right.legController.relax()},tighten:function(){this.left.legController.extend(1),this.right.legController.extend(1),this.left.armController.retract(1),this.right.armController.retract(1)},startInvincibility:function(a){this._invincible=!0,this._invincibilityTimer=a||b.Invincibility.Duration},startWakeUp:function(){this._asleep=!0,this._wakeUpTimer=b.WakeUp.Duration},onContact:function(a,b,c){c.collisionGroup===this.collisionGroups.enemy.damage.mask?this.takeDamage(15):c.collisionGroup===this.collisionGroups.enemy.blocked.mask&&this.chipDamage(5)},onCollideFist:function(){this.takeDamage(8)},onCollideBlocked:function(){this.chipDamage(2)},onCollideMagic:function(a){if(!this._invincible){this.takeDamage(15);var c=this.torso.x,d=this.torso.y-2e3;a.applyForce([0,b.Magic.UpwardForce],c,d),this.torso.body.applyForce([0,b.Magic.UpwardForce/2],c,d)}},onMatchStart:function(){this.inputEnabled=!0},onLeftArmStateChange:function(a,b){console.log('left arm: "'+b+'" -> "'+a+'"');var c=this.blocking.left,d="retracted"===a;c!==d&&(this.blocking.left=d,this.events.onBlockStatus.dispatch("left",d))},onRightArmStateChange:function(a,b){console.log('right arm: "'+b+'" -> "'+a+'"');var c=this.blocking.right,d="retracted"===a;c!==d&&(this.blocking.right=d,this.events.onBlockStatus.dispatch("right",d))}};var e=new Phaser.Rectangle,f=new Phaser.Rectangle;HasHpMixin(b.prototype),Object.defineProperties(b.prototype,{inputEnabled:{get:function(){return this._inputEnabled},set:function(a){a!==this._inputEnabled&&(a?this.events.onInputEnabled.dispatch(this):this.events.onInputDisabled.dispatch(this),this._inputEnabled=a)}},cameraRect:{get:function(){return c(this._parts,e),e}},bodyRect:{get:function(){return c(this._coreParts,f),f.x-=40,f.width+=80,f}}}),d.prototype=Object.create(Phaser.Sprite.prototype),d.prototype.constructor=d,_.extend(d.prototype,{update:function(){this.prev.x=this.body.x,this.prev.y=this.body.y},calculateVelocity:function(){var a=Phaser.Point.distance(this.prev,this.body);return a/game.time.physicsElapsed}}),Object.defineProperty(d.prototype,"circle",{get:function(){return this._circle.x=this.body.x,this._circle.y=this.body.y,this._circle}}),a.PlayerDamage=d,a.Robot=b}(this),function(a){function b(a,b,c,d){Phaser.Sprite.call(this,a,c,d),a.physics.p2.enable(this),this.body.clearShapes(),this.body.addCircle(40),this.body.mass=1.2,this.body.setCollisionGroup(b.enemy.damage),this.body.collides(b.player.body),this.collisionGroups=b,this.blocked={left:!1,right:!1},this.isBlocked=!1}b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,_.extend(b.prototype,{onBlockStatus:function(a,b){this.blocked[a]=b},update:function(){if(this.alive){var a=this.blocked,b=this.isBlocked,c=this.body.velocity.x<0&&a.left||this.body.velocity.x>0&&a.right;if(b!=c){var d=this.collisionGroups.enemy.blocked,e=this.collisionGroups.enemy.damage;this.body.setCollisionGroup(c?d:e),this.isBlocked=c,console.log(c?"punch is blocked":"punch will hit!")}}}}),a.EnemyPunchDamage=b}(this),function(a){function b(a,b,c,d){Phaser.Sprite.call(this,a,c,d,"magic-missile"),this.anchor.setTo(.5,.5),this.animations.add("loop",[0,1,2,3],15,!0),this.animations.play("loop"),a.physics.p2.enable(this),this.body.clearShapes(),this.body.addCircle(20),this.body.mass=5,this.body.setCollisionGroup(b.enemy.magic),this.body.collides(b.world,this.onCollidesGround,this),this.body.collides(b.player.body,this.onCollidesPlayer,this),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.state="none",this.collisionGroups=b,_.extend(this.events,{onExplode:new Phaser.Signal})}_.extend(b,{preload:function(a){a.spritesheet("magic-missile","assets/magic missile.ba349b48.png",128,128,4)}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,_.extend(b.prototype,{update:function(){switch(this.state){case"charging":this.body.setZeroVelocity()}},charge:function(a,b){this.reset(a,b),this.body.setZeroVelocity(),this.state="charging"},fire:function(a,b){switch(this.state){case"none":case"charging":this.dir=0>a?Phaser.LEFT:Phaser.RIGHT,this.body.moveRight(a),this.body.moveDown(b),this.state="falling"}},onCollidesGround:function(){switch(this.state){case"falling":this.state="grounded",this.body.moveLeft(this.dir===Phaser.LEFT?500:-500)}},onCollidesPlayer:function(){this.kill(),this.events.onExplode.dispatch(this)}}),a.EnemyMagicMissile=b}(this),function(a){function b(a,b,d,e){Phaser.Sprite.call(this,a,d,e),this.initialize(100),this.anchor.setTo(.5,.5),a.physics.arcade.enable(this),this.body.setSize(73,256);var f=this.victim=a.add.existing(new c(this.game,0,0,73,256));this.addChild(f),_.extend(this.events,{onCommandPause:new Phaser.Signal,onCommandResume:new Phaser.Signal,onActionComplete:new Phaser.Signal}),this.collisionGroups=b,this._startY=e,this._facing=Phaser.LEFT,this._state="none",this._touchedGround=!1,this._acceptCommands=!0,this._vulnerable=!0;var g=this._punchBullet=new EnemyPunchDamage(a,this.collisionGroups,0,0);this.game.add.existing(g),g.kill();for(var h=this._missiles=a.add.group(),i=0;5>i;i++){var j=new EnemyMagicMissile(this.game,b);h.add(j),j.kill()}this.idle()}function c(a,b,c,d,e){Phaser.Sprite.call(this,a,b,c),this.anchor.setTo(.5,.5),a.physics.arcade.enable(this),this.body.setSize(d,e),this._square=new Phaser.Rectangle(b,c,d,e)}_.extend(b,{Knockback:{Gravity:500,TurnThreshold:20,Launch:{X:200,Y:-450}},WakeUp:{Time:1.5},StandUp:{Time:500},Distance:{Far:500,Mid:300,Near:150},Move:{Speed:200,CrossSpeed:600,Ascend:{Height:250,Duration:750}},Punch:{Offset:{X:0,Y:-150},Velocity:{X:850,Y:-450},Lifetime:200},Cast:{Offset:{X:95,Y:-115},Velocity:{X:250,Y:550},StartingScale:.1,Duration:1500,Cooldown:{Duration:.33}},preload:function(a){a.atlasJSONArray("enemy-atlas","assets/enemy.b849b5f8.png","assets/enemy.f871be15.json"),a.atlasJSONArray("enemy-extra-atlas","assets/enemy extra.11ff6cd6.png","assets/enemy extra.f75f9dbc.json")}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,HasHpMixin(b.prototype),_.extend(b.prototype,{magicMissile:function(){var a=this.x+(this.facing===Phaser.LEFT?-b.Cast.Offset.X:b.Cast.Offset.X),c=this.y+b.Cast.Offset.Y,d=this.facing==Phaser.LEFT?-b.Cast.Velocity.X:b.Cast.Velocity.Y,e=b.Cast.Velocity.Y,f=this._missiles.getFirstDead();this._chargingMissile=f,f.charge(a,c),f.scale.setTo(b.Cast.StartingScale,b.Cast.StartingScale),this.game.add.tween(f.scale).to({x:1,y:1},b.Cast.Duration,void 0,!0).onComplete.addOnce(function(){this._castCooldown=0,this._castComplete=!0,f.fire(d,e)},this)},takeDamage:function(a){if(this._vulnerable){var c=b.Knockback.Launch.X,d=b.Knockback.Launch.Y;c=a===Phaser.LEFT?c:-c,this.knockback(c,d),this._punchBullet.kill(),this._hp-=10,this.events.onDamage.dispatch(this._hp,this._maxHp)}},update:function(){switch(this.state){case"knocked back":this.body.velocity.y>-b.Knockback.TurnThreshold&&(this.animations.play("fall-back"),this.body.setSize(284,42,0,30),this.body.bounce.setTo(.3,.3),this.state="falling");break;case"waking up":this._wakeUpTimer+=this.game.time.physicsElapsed,this._wakeUpTimer>=b.WakeUp.Time&&this.stand();break;case"punching":if(!this._firedPunchBullet&&"slash__003.png"===this.animations.currentFrame.name){var a=(this.game,this.x+b.Punch.Offset.X),c=this.y+b.Punch.Offset.Y,d=this.facing==Phaser.RIGHT?b.Punch.Velocity.X:-b.Punch.Velocity.X,e=-b.Punch.Velocity.Y,f=this._punchBullet;f.reset(a,c),f.lifespan=b.Punch.Lifetime,f.body.velocity.x=d,f.body.velocity.y=e,this._firedPunchBullet=!0}break;case"casting":this._castComplete&&(this._castCooldown+=this.game.time.physicsElapsed,this._castCooldown>b.Cast.Cooldown.Duration&&(this._castCooldown=-1e4,this.animations.play("stop-cast").onComplete.addOnce(function(){this.idle(),this.events.onActionComplete.dispatch(this,"cast")},this)))}},onCollision:function(){switch(this.state){case"falling":case"waking up":this.body.velocity.x=.7*this.body.velocity.x,this._touchedGround||(this._touchedGround=!0,this.wakeUp());break;default:this._dropping&&(this._dropping=!1,this.body.acceleration.y=0,this.game.add.tween(this).to({y:this._startY},200).start())}},punch:function(a){switch(this.state){case"none":case"idle":this.startPunch(a);break;case"advancing":this.doPunch(a);break;case"retreating":this.stopRetreat(function(){this.startPunch(a)})}},cast:function(){switch(this.state){case"none":case"idle":this.doCast();break;case"advancing":this.stopAdvance(this.doCast);break;case"retreating":this.stopRetreat(this.doCast)}},idle:function(){switch(this.state){case"idle":return;case"none":case"standing":case"ascending":case"punching":case"casting":this.doIdle();break;case"advancing":this.stopAdvance(this.doIdle);break;case"retreating":this.stopRetreat(this.doIdle)}},advance:function(a){switch(this.state){case"advancing":this.body.velocity.x=a,this.setFacing(a);break;case"none":case"idle":this.doAdvance(a);break;case"retreating":this.stopRetreat(function(){this.doAdvance(a)}),this.body.velocity.x=a}},retreat:function(a){switch(this.state){case"retreating":this.body.velocity.x=a,this.setFacing(-a);break;case"none":case"idle":this.doRetreat(a);break;case"advancing":this.stopAdvance(function(){this.doRetreat(a)}),this.body.velocity.x=a}},ascend:function(a,b){switch(this.state){case"none":case"idle":this.doAscend(a,b);break;case"advancing":this.stopAdvance(function(){this.doAscend(a,b)}),this.body.velocity.x=0;break;case"retreating":this.stopRetreat(function(){this.doAscend(a,b)}),this.body.velocity.x=0}},drop:function(){!this._dropping&&this.ascended&&(this._dropping=!0,this.ascended=!1,this.body.acceleration.y=b.Knockback.Gravity)},knockback:function(a,c){this._vulnerable=!1,this.acceptCommands=!1,this.switchToMainAtlas(),this.setFacing(-a),this.animations.play("knocked-up"),this.body.velocity.setTo(a,c),this.body.acceleration.y=b.Knockback.Gravity,this._touchedGround=!1,this.state="knocked back"},wakeUp:function(){this._vulnerable=!0,this._wakeUpTimer=0,this.state="waking up"},stand:function(){"waking up"==this.state&&(this.body.velocity.setTo(0,0),this.body.acceleration.y=0,this.game.add.tween(this).to({y:this._startY},b.StandUp.Time).start(),this.switchToExtraAtlas(),this.animations.play("stand").onComplete.addOnce(function(){this.acceptCommands=!0,this.body.setSize(73,256,0,0),this.idle()},this),this.state="standing")},doCast:function(){this.switchToMainAtlas(),this.animations.play("start-cast").onComplete.addOnce(function(){this.animations.play("casting"),this.magicMissile()},this),this._castComplete=!1,this._castCooldown=0,this.body.velocity.x=0,this.state="casting"},startPunch:function(a){this.switchToMainAtlas(),this.setFacing(a),this.animations.play("start-advance").onComplete.addOnce(function(){this.doPunch(a)},this),this.body.velocity.x=a,this.state="punching"},doPunch:function(a){this.switchToExtraAtlas(),this.setFacing(a),this.animations.play("slash").onComplete.addOnce(this.stopPunch,this),this._firedPunchBullet=!1,this.body.velocity.x=a,this.body.velocity.y=0,"punching"!==this.state&&(this.state="punching")},stopPunch:function(){this.switchToMainAtlas(),this.animations.play("stop-advance").onComplete.addOnce(function(){this.idle(),this.events.onActionComplete.dispatch(this,"punch")},this)},doIdle:function(){this.switchToMainAtlas(),this.animations.play("idle"),this.body.velocity.setTo(0,0),this.state="idle"},doAdvance:function(a){this.switchToMainAtlas(),this.setFacing(a),this.animations.play("start-advance").onComplete.addOnce(function(){this.animations.play("advancing")},this),this.body.velocity.x=a,this.state="advancing"},doRetreat:function(a){this.switchToMainAtlas(),this.setFacing(-a),this.animations.play("start-retreat").onComplete.addOnce(function(){this.animations.play("retreating")},this),this.body.velocity.x=a,this.state="retreating"},stopAdvance:function(a,b){b=b||this,"advancing"!==this.state?a.apply(this):this.animations.play("stop-advance").onComplete.addOnce(a,b)},stopRetreat:function(a,b){b=b||this,"retreating"!==this.state?a.apply(this):this.animations.play("stop-retreat").onComplete.addOnce(a,b)},doAscend:function(a,b){this.switchToMainAtlas(),this.animations.play("idle");var c=this.game.add.tween(this).to({y:this._startY-a},b,Phaser.Easing.Quadratic.InOut);c.onComplete.addOnce(function(){this.idle(),this.events.onActionComplete.dispatch(this,"ascend")},this),c.start(),this.state="ascending"},setFacing:function(a){this.facing=0>a?Phaser.LEFT:Phaser.RIGHT},switchToMainAtlas:function(){"enemy-atlas"!==this.key&&(this.loadTexture("enemy-atlas"),this.anchor.setTo(.5,.5),this.animations.add("idle",Phaser.Animation.generateFrameNames("idle__",0,9,".png",3),10,!0),this.animations.add("start-advance",Phaser.Animation.generateFrameNames("advance__",0,2,".png",3),10),this.animations.add("advancing",Phaser.Animation.generateFrameNames("advance__",3,5,".png",3),10,!0),this.animations.add("stop-advance",Phaser.Animation.generateFrameNames("advance__",2,0,".png",3),10),this.animations.add("start-retreat",Phaser.Animation.generateFrameNames("retreat__",0,2,".png",3),10),this.animations.add("retreating",Phaser.Animation.generateFrameNames("retreat__",3,5,".png",3),10,!0),this.animations.add("stop-retreat",Phaser.Animation.generateFrameNames("retreat__",2,0,".png",3),10),this.animations.add("knocked-up",["knockback__000.png"],1,!0),this.animations.add("fall-back",Phaser.Animation.generateFrameNames("knockback__",0,5,".png",3),10),this.animations.add("fallen",["knockback__005.png"],1,!0),this.animations.add("start-cast",Phaser.Animation.generateFrameNames("wave_attack__",0,5,".png",3),10),this.animations.add("casting",["wave_attack__005.png"],1,!0),this.animations.add("stop-cast",Phaser.Animation.generateFrameNames("wave_attack__",5,0,".png",3),10))},switchToExtraAtlas:function(){"enemy-extra-atlas"!==this.key&&(this.loadTexture("enemy-extra-atlas"),this.anchor.setTo(.5,.5),this.animations.add("slash",Phaser.Animation.generateFrameNames("slash__",0,7,".png",3),15),this.animations.add("stand",Phaser.Animation.generateFrameNames("stand__",0,7,".png",3),10))},onBlockStatus:function(a,b){this._punchBullet.onBlockStatus(a,b)}});var d=new Phaser.Rectangle;Object.defineProperties(b.prototype,{facing:{get:function(){return this._facing},set:function(a){a===Phaser.RIGHT?(this.scale.x=-1,this._facing=Phaser.RIGHT):(this.scale.x=1,this._facing=Phaser.LEFT)}},state:{get:function(){return this._state},set:function(a){this.prevState=this._state,this._state=a}},ascended:{get:function(){return this.y<this._startY}},dropping:{get:function(){return this._dropping}},vulnerable:{get:function(){return this._vulnerable}},acceptCommands:{get:function(){return this._acceptCommands},set:function(a){a!=this._acceptCommands&&(a?this.events.onCommandResume.dispatch(this):this.events.onCommandPause.dispatch(this),this._acceptCommands=a)}},cameraRect:{get:function(){var a=this.getBounds();return d.copyFrom(a),d.x+=this.game.camera.x,d.y+=this.game.camera.y,d}}}),c.prototype=Object.create(Phaser.Sprite.prototype),c.prototype.constructor=c,Object.defineProperty(c.prototype,"rect",{get:function(){return this._square.x=this.body.x,this._square.y=this.body.y,this._square}}),a.Enemy=b}(this),function(a){function b(a){this.player=a,this._rect=new Phaser.Rectangle}b.prototype={update:function(){this._rect.copyFrom(this.player.bodyRect)},withinDistance:function(a,b){var c=a.x>this.x?this.right:this.left;return Math.abs(c-a.x)<b}},Object.defineProperties(b.prototype,{x:{get:function(){return this._rect.centerX}},y:{get:function(){return this._rect.centerY}},left:{get:function(){return this._rect.left}},right:{get:function(){return this._rect.right}}}),a.PlayerSensor=b}(this),function(a){function b(){this.onStart=new Phaser.Signal,this.onComplete=new Phaser.Signal}function c(a,c){this.agent=a,this.sensor=c,this.started=!1,this.completed=!1,this.events=new b}c.prototype={update:function(){this.started||(this.start(),this.started=!0,this.events.onStart.dispatch(this)),this.completed||this.think(),this.completed&&this.events.onComplete.dispatch(this)},start:function(){},think:function(){},complete:function(){this.completed=!0}},a.Action=c}(this),function(a){function b(a,b){Action.call(this,a),this.delay=b,this.timer=0}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){this.agent.idle()},think:function(){this.timer+=this.agent.game.time.physicsElapsed,this.timer>this.delay&&this.complete()}}),a.WaitAction=b}(this),function(a){function b(a,b){Action.call(this,a,b)}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){var a=this.agent,b=this.sensor,c=b.x<a.x?-Enemy.Move.Speed:Enemy.Move.Speed;b.withinDistance(a,Enemy.Distance.Near+10)?this.complete():a.advance(c)},think:function(){var a=this.agent,b=this.sensor;if(b.withinDistance(a,Enemy.Distance.Near))this.complete();else{var c=b.x<a.x?-Enemy.Move.Speed:Enemy.Move.Speed;a.advance(c)}}}),a.GoNearAction=b}(this),function(a){function b(a,b){Action.call(this,a,b)}b.Slop=10,b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){var a=this.agent,c=this.sensor,d=a.x>c.x?Phaser.RIGHT:Phaser.LEFT;
this.side=d,d==Phaser.RIGHT?a.x<c.right+Enemy.Distance.Mid-b.Slop?a.retreat(Enemy.Move.Speed):a.advance(-Enemy.Move.Speed):a.x<c.left-Enemy.Distance.Mid+b.Slop?a.advance(Enemy.Move.Speed):a.retreat(-Enemy.Move.Speed)},think:function(){var a=this.agent,c=this.sensor,d=this.side;this.side==Phaser.RIGHT&&Math.abs(c.right+Enemy.Distance.Mid-a.x)<b.Slop||this.side==Phaser.LEFT&&Math.abs(c.left-Enemy.Distance.Mid-a.x)<b.Slop?this.complete():(d=a.x>c.x?Phaser.RIGHT:Phaser.LEFT,this.side=d,d==Phaser.RIGHT?a.x<c.right+Enemy.Distance.Mid-b.Slop?a.retreat(Enemy.Move.Speed):a.advance(-Enemy.Move.Speed):a.x<c.left-Enemy.Distance.Mid+b.Slop?a.advance(Enemy.Move.Speed):a.retreat(-Enemy.Move.Speed))}}),a.GoMidAction=b}(this),function(a){function b(a,b){Action.call(this,a,b)}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){var a=this.agent,b=this.sensor,c=a.x<b.x?-Enemy.Move.Speed:Enemy.Move.Speed;a.retreat(c)},think:function(){var a=this.agent,b=this.sensor;b.withinDistance(a,Enemy.Distance.Far)||this.complete()}}),a.GoFarAction=b}(this),function(a){function b(a){Action.call(this,a)}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){this.agent.ascend(Enemy.Move.Ascend.Height,Enemy.Move.Ascend.Duration)},think:function(){"idle"===this.agent.state&&this.complete()}}),a.AscendAction=b}(this),function(a){function b(a){Action.call(this,a)}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){this.agent.drop(),this.complete()}}),a.DropAction=b}(this),function(a){function b(a,b,c){Action.call(this,a,b),this.distance=c||Enemy.Distance.Mid}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){var a=this.agent,b=this.sensor,c=a.x>b.x?Phaser.RIGHT:Phaser.LEFT;c===Phaser.RIGHT?(this.target=b.left-this.distance,a.advance(-Enemy.Move.CrossSpeed)):(this.target=b.right+this.distance,a.advance(Enemy.Move.CrossSpeed)),this.side=c},think:function(){var a=this.agent,b=this.side,c=this.target;(b===Phaser.RIGHT&&a.x<c||b===Phaser.LEFT&&a.x>c)&&this.complete()}}),a.CrossAction=b}(this),function(a){function b(a,b){Action.call(this,a,b)}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){var a=this.agent,b=this.sensor,c=a.x<b.x?Enemy.Move.Speed:-Enemy.Move.Speed;a.punch(c),a.events.onActionComplete.addOnce(this.complete,this)}}),a.PunchAction=b}(this),function(a){function b(a,b){Action.call(this,a,b)}b.prototype=Object.create(Action.prototype),b.prototype.constructor=b,_.extend(b.prototype,{start:function(){var a=this.agent;a.cast(),a.events.onActionComplete.addOnce(this.complete,this)}}),a.CastAction=b}(this),function(a){function b(a,b,c){this.acceptsCommands=!0,this.thinking=!1,this.enemy=b,this.player=a,this.sensor=new PlayerSensor(a),this.rnd=c,this.actionQueue=[],b.events.onDamage.add(this.onDamage,this),b.events.onCommandPause.add(this.onCommandPause,this),b.events.onCommandResume.add(this.onCommandResume,this)}b.prototype={weightedSelect:function(a,b){for(var c=_.reduce(a,function(a,b){return a+b}),d=this.rnd.integerInRange(0,c),e=0,f=0;c>e;){if(e+=a[f],e>d)return b[f];f++}return b[b.length-1]},update:function(){if(this.sensor.update(),this.actionQueue.length>0){var a=this.actionQueue[0];a.update()}},chooseNextAction:function(){return void this.do(["mid","cast"])},"do":function(a){if(_.isArray(a))_.forEach(a,this.do,this);else{console.log('doing "'+a+'"');var b=this.createAction(a);this.actionQueue.push(b),b.events.onComplete.addOnce(this.onActionComplete,this)}},createAction:function(a){var b=this.enemy,c=this.sensor;switch(a){case"near":return new GoNearAction(b,c);case"mid":return new GoMidAction(b,c);case"far":return new GoFarAction(b,c);case"ascend":return new AscendAction(b);case"drop":return new DropAction(b);case"far cross":case"cross":return new CrossAction(b,c);case"near cross":return new CrossAction(b,c,Enemy.Distance.Near);case"pause":return new WaitAction(b,1);case"punch":return new PunchAction(b,c);case"cast":return new CastAction(b,c)}},onActionComplete:function(){this.prevAction=this.actionQueue.shift(),0===this.actionQueue.length&&this.chooseNextAction()},onMatchStart:function(){this.chooseNextAction()},onDamage:function(){this.actionQueue.length=0},onCommandPause:function(){this.acceptsCommands=!1},onCommandResume:function(){this.acceptsCommands=!0,0===this.actionQueue.length&&this.chooseNextAction()}},a.EnemyController=b}(this),function(a){function b(a,c,d,e){Phaser.Sprite.call(this,a,c,d),this.anchor.setTo(.5,.5),this.fighters=e;var f=b.Bounds.Width,g=b.Bounds.Height;this.rects=_.map(e,function(a){return new Phaser.Rectangle(a.x-f/2,a.y-g/2,f,g)},this),a.physics.arcade.enable(this),this.target=new Phaser.Rectangle(c,d,800,600)}var c=new Phaser.Point,d=new Phaser.Point;_.extend(b,{Bounds:{Width:200,Height:400,Padding:25},Spring:{Stiffness:100,Damping:50}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,_.extend(b.prototype,{update:function(){var a=this.rects,e=this.fighters,f=this.target;f.x=f.y=0;for(var g=0;g<e.length;g++)a[g].copyFrom(e[g].cameraRect),f.x+=a[g].centerX,f.y+=a[g].centerY;f.x=f.x/e.length-400,f.y=f.y/e.length-300,first=a[0],f.left>first.left?f.x=first.left:f.right<first.right&&(f.x=first.right-800),f.top>first.top?f.y=first.top:f.bottom<first.bottom&&(f.y=first.bottom-600),c.setTo(f.centerX,f.centerY),Phaser.Point.subtract(c,this.body.position,c),c.multiply(b.Spring.Stiffness,b.Spring.Stiffness),d.copyFrom(this.body.velocity),d.multiply(b.Spring.Damping,b.Spring.Damping),Phaser.Point.subtract(c,d,this.body.acceleration)}}),a.FightCamera=b}(this),function(a){function b(a,b,c,d){Phaser.Sprite.call(this,a,b,c,"hp-guages","guage-bg"),this.fixedToCamera=!0;var e=this._guage=a.make.sprite(0,1,"hp-guages",d+"-hp-guage"),f=a.make.sprite(-3,-3,"hp-guages",d+"-hp-guage-overlay");this.addChild(e),this.addChild(f),this._width=e.width;var g=this._rect=new Phaser.Rectangle(0,0,1,e.height);e.crop(g),this.team=d,this._curr=0,this._target=1}_.extend(b,{Speed:.33,preload:function(a){a.atlasJSONHash("hp-guages","assets/health guages.6a590e3b.png","assets/health guages.49b6760a.json")}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,_.extend(b.prototype,{update:function(){var a=this._curr,c=this._target,d=!1;if(a>c?(d=!0,a-=b.Speed*this.game.time.physicsElapsed,c>a&&(a=c)):c>a&&(d=!0,a+=b.Speed*this.game.time.physicsElapsed,a>c&&(a=c)),d){var e=this._guage,f=this._rect,g=Math.floor(this._width*a);"player"===this.team?(f.width=g,e.x=this._width-g):f.width=g,this._curr=a,e.crop(f)}},onDamage:function(a,b){this._target=a/b}}),a.HealthBar=b}(this),function(a){function b(a,b,c){Phaser.Sprite.call(this,a,b,c,"timer-bar-bg");var d=this._bar=a.make.sprite(0,0,"timer-bar"),e=this._rect=new Phaser.Rectangle(0,0,1,this.height);this.addChild(d),d.crop(e)}_.extend(b,{preload:function(a){a.image("timer-bar-bg","assets/timer bar bg.7000549c.png"),a.image("timer-bar","assets/timer bar.35ceeabe.png")}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,Object.defineProperties(b.prototype,{value:{set:function(a){a=Math.max(0,a),a=Math.min(1,a),this._rect.width=Math.floor(this.width*a),this._bar.crop(this._rect)}}}),a.TimerBar=b}(this),function(a){function b(a,b,c){Phaser.Group.call(this,a),this.fixedToCamera=!0,_.extend(this,{commandKeyPool:b,commandsToKeyCodes:c});var d=this.timerBar=this.add(new TimerBar(a,-50,18));d.visible=!1,d.value=0,this._inputEnabled=!0}_.extend(b,{Spacing:{Height:32,Gap:4},Tween:{Duration:500},CommandLifetime:3e3,preload:function(){}}),b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,_.extend(b.prototype,{moveAllUp:function(){var a,c=b.Spacing.Height+b.Spacing.Gap;this.forEach(function(d){d instanceof CommandString&&(a=d.y-c,this.game.add.tween(d).to({y:a},b.Tween.Duration).start())},this)},onStringStart:function(){var a=new CommandString(this.game,this.commandKeyPool,this.x,this.y);this.add(a),this.workingString=a,this.timerBar.visible=!0},onStringEnd:function(){this.workingString.fadeOut(b.CommandLifetime),this.workingString=void 0,this.moveAllUp(),this.timerBar.visible=!1},onCommand:function(a){if(this.workingString){var b=this.commandsToKeyCodes[a];b?this.workingString.addKey(b):console.error('cannot find keycode for command "'+a+'"')}},onTimerChanged:function(a,b,c){this.timerBar.value=c}}),a.CommandDisplay=b}(this),function a(b){function a(a){Phaser.Group.call(this,a);var b=this.pages=[a.make.sprite(0,0,"instructions-page-1"),a.make.sprite(0,0,"instructions-page-2")];_.forEach(b,function(b){this.add(b),b.anchor.setTo(.5,.5),b.position.setTo(a.width/2,a.height/2),b.visible=!1},this),this.currentPage=0,b[0].visible=!0,this.events={onComplete:new Phaser.Signal};var c=this.advanceKey=a.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);c.onDown.add(this.advance,this)}_.extend(a,{preload:function(a){a.image("instructions-page-1","assets/instructions for keys.6983c503.png"),a.image("instructions-page-2","assets/instructions for strings.a22ef008.png")}}),a.prototype=Object.create(Phaser.Group.prototype),a.prototype.constructor=a,Mixin.create({destroy:function(){this.advanceKey.onDown.remove(this.advance,this),this.__super.apply(this,arguments)},advance:function(){var a=this.pages,b=this.currentPage;newPage=this.currentPage+1,a[b].visible=!1,newPage>=a.length?(this.events.onComplete.dispatch(),this.destroy()):(a[newPage].visible=!0,this.currentPage=newPage)}})(a.prototype),b.Instructions=a}(this),function(a){a.FadeMixin=Mixin.create({fader:function(){var a=this.game,b=this.add.tileSprite(0,0,800,600,"black");return b.fixedToCamera=!0,a.world.bringToTop(b),b},fadeIn:function(a,b){var c=this.game,d=this.fader(),e=c.add.tween(d).to({alpha:0},b,void 0,!0,a);return{onComplete:e.onComplete}},fadeOut:function(a,b){var c=this.fader(),d=this.add.tween(c).to({alpha:1},a).to({alpha:1},b||0);return c.alpha=0,d.start(),{onComplete:d.onComplete}}})}(this),function(a){function b(){}b.prototype={preload:function(){this.load.image("loading-bar","assets/loading bar.f44b1a70.png"),this.load.image("loading-bar-bg","assets/loading bar bg.1fe86dc8.png"),this.load.image("black","assets/black.94fac32b.png")},create:function(){this.state.start("preload")}},a.Boot=b}(this),function(a){function b(){}b.prototype={preload:function(){var a=250,b=296,c=this.add,d=this.load;c.sprite(a,b,"loading-bar-bg");var e=c.sprite(a,b,"loading-bar");d.setPreloadSprite(e),d.bitmapFont("minecraftia","assets/minecraftia.d0c5b06a.png","assets/minecraftia.22ff6d4c.xml"),Robot.preload(d),Ground.preload(d),CommandKeyPool.preload(d),TimerBar.preload(d),CommandDisplay.preload(d),Instructions.preload(d),HealthBar.preload(d),Enemy.preload(d),Intro.preload(d),EnemyMagicMissile.preload(d),d.onLoadComplete.addOnce(this.onLoadComplete,this)},create:function(){this.stage.setBackgroundColor("#530301")},onLoadComplete:function(){this.state.start("game")}},FadeMixin(b.prototype),a.Preload=b}(this),function(a){function b(){}b.preload=function(a){a.image("wedges","assets/wedges.f66831bc.png"),a.image("title","assets/title.bb53c8c5.png"),a.image("press-space","assets/title press space.4a9a5f89.png")},b.prototype={create:function(){this.game.stage.setBackgroundColor("#ecb95e"),this.addWedges(0),this.addWedges(30),this.addWedges(60),this.addWedges(90),this.addWedges(120),this.addWedges(150);var a=this.add.sprite(400,280,"title");a.anchor.setTo(.5,.5),this.game.add.tween(a).to({y:320},750,Phaser.Easing.Quadratic.InOut,!0,0,Number.MAX_VALUE,!0);var b=this.game.add.sprite(620,550,"press-space");b.anchor.setTo(.5,.5),this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(function(){this.fadeOut(700,500).onComplete.add(function(){this.game.state.start("game")},this)},this),this.fadeIn(500,700)},addWedges:function(a){var b=this.add.sprite(400,300,"wedges");b.anchor.setTo(.5,.5),b.angle=a,this.game.physics.arcade.enable(b),b.body.angularVelocity=40}},FadeMixin(b.prototype),a.Intro=b}(this),function(a){function b(){}b.prototype={create:function(){var a=this.game.physics,b=this.add,c=!1;this.game.stage.setBackgroundColor("#6495ED"),this.world.setBounds(-800,-1200,2400,1800),a.startSystem(Phaser.Physics.P2JS),a.p2.setImpactEvents(!0),a.p2.gravity.y=500;var d={world:a.p2.createCollisionGroup(),player:{body:a.p2.createCollisionGroup(),damage:a.p2.createCollisionGroup(),victim:a.p2.createCollisionGroup()},enemy:{body:a.p2.createCollisionGroup(),damage:a.p2.createCollisionGroup(),victim:a.p2.createCollisionGroup(),blocked:a.p2.createCollisionGroup(),magic:a.p2.createCollisionGroup()}},e={world:a.p2.createMaterial("worldMaterial"),robot:a.p2.createMaterial("robotMaterial")},f=a.p2.createContactMaterial(e.world,e.robot);f.friction=1;var g=(this.ground=b.existing(new Ground(this.game,d,e,568)),this.robot=new Robot(this.game,d,e,200,300,c)),h=this.enemy=b.existing(new Enemy(this.game,d,600,350)),i=this.dolly=b.existing(new FightCamera(this.game,400,300,[g,h]));this.camera.follow(i);var j=this.enemyController=new EnemyController(g,h,this.game.rnd),k=b.existing(new HealthBar(this.game,20,20,"player"));g.events.onDamage.add(k.onDamage,k);var l=b.existing(new HealthBar(this.game,440,20,"enemy"));h.events.onDamage.add(l.onDamage,l);var m=this.commandBuffer=new CommandBuffer(this.game),n=this.commandKeyPool=new CommandKeyPool(this.game),o=this.commandDisplay=new CommandDisplay(this.game,n,m.commandsToKeyCodes);o.x=200,o.y=275,o.timerBar.x=135,o.timerBar.y=292,o.fixedToCamera=!0,m.events.onStringEnd.add(g.processCommandString,g),m.events.onStringStart.add(o.onStringStart,o),m.events.onCommand.add(o.onCommand,o),m.events.onStringEnd.add(o.onStringEnd,o),m.events.onTimerChanged.add(o.onTimerChanged,o),g.events.onInputEnabled.add(m.onInputEnabled,m),g.events.onInputDisabled.add(m.onInputDisabled,m),g.events.onBlockStatus.add(h.onBlockStatus,h),g.events.onDefeated.add(this.onDefeated,this),h.events.onCommandPause.add(function(){console.log("commands paused")}),h.events.onCommandResume.add(function(){console.log("commands resumed")}),h.events.onDefeated.add(this.onDefeated,this),j.onMatchStart(),g.onMatchStart()},update:function(){this.commandBuffer.update(),this.enemyController.update(),this.robot.update(),_.forEach(this.robot.damageSources,function(a){var b=a.calculateVelocity();if(b>Robot.Attack.Speed.Min&&SAT.circleVsRect(a.circle,this.enemy.victim.rect)){var c=this.robot.torso.x<this.enemy.x?Phaser.LEFT:Phaser.RIGHT;this.enemy.takeDamage(c,a.circle,b)}},this),this.enemy.vulnerable&&this.game.physics.arcade.collide(this.enemy,this.robot.arcade),this.game.physics.arcade.collide(this.enemy,this.ground.arcade,void 0,this.enemy.onCollision,this.enemy)},render:function(){},onDefeated:function(){}},FadeMixin(b.prototype),a.Game=b}(this);var game=new Phaser.Game(800,600,Phaser.AUTO,"game-container");game.state.add("boot",Boot),game.state.add("preload",Preload),game.state.add("intro",Intro),game.state.add("game",Game),game.state.start("boot");